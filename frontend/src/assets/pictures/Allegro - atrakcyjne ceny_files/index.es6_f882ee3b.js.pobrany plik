((e,t)=>{for(var i in t)e[i]=t[i]})(window,(e=>{var t={};function i(s){if(t[s])return t[s].exports;var a=t[s]={i:s,l:!1,exports:{}};return e[s].call(a.exports,a,a.exports,i),a.l=!0,a.exports}return i.m=e,i.c=t,i.d=(e,t,s)=>{i.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:s})},i.r=e=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},i.t=(e,t)=>{if(1&t&&(e=i(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var s=Object.create(null);if(i.r(s),Object.defineProperty(s,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var a in e)i.d(s,a,(t=>e[t]).bind(null,a));return s},i.n=e=>{var t=e&&e.__esModule?()=>e.default:()=>e;return i.d(t,"a",t),t},i.o=(e,t)=>({}.hasOwnProperty.call(e,t)),i.p="https://assets.allegrostatic.com/opbox-expandable-advertisement/",i(i.s=0)})({0(e,t,i){e.exports=i("WdQY")},WdQY(e,t,i){function s(e,t,i){return t in e?Object.defineProperty(e,t,{value:i,enumerable:!0,configurable:!0,writable:!0}):e[t]=i,e}function a(e,t=[]){if(!e||!t.length)return;const i=t.map(({imageUrl:e})=>{try{const{href:t}=new URL(e);return`<img alt="" src="${t}&timestamp=${Date.now()}" />`}catch(t){return""}}).join("");if(i){const t=document.createElement("span");t.className="mpof_5r",t.innerHTML=i,e.appendChild(t)}}i.r(t);const n={root:null,rootMargin:"0px",threshold:.5};class o{constructor(e){s(this,"visible",!1),s(this,"elementIsVisibleTimestamp",0),s(this,"boxVisibleTimeoutId",null),s(this,"visibleTimeLeft",1e3),s(this,"handleVisibilityChange",()=>{this.handleElementVisibility(!document.hidden)}),s(this,"handleIntersection",e=>{const t=e[0],i=t.isIntersecting&&t.intersectionRatio>=.5;this.handleElementVisibility(i)}),s(this,"handleElementVisibility",e=>{this.visible!==e&&(this.visible=e,e?(this.updateElementIsVisibleTimestamp(),this.createTimeout()):(this.updateVisibleTimeLeft(),this.clearTimeout()))}),s(this,"updateElementIsVisibleTimestamp",()=>{this.elementIsVisibleTimestamp=performance.now()}),s(this,"updateVisibleTimeLeft",()=>{const e=performance.now()-this.elementIsVisibleTimestamp;this.visibleTimeLeft-=e}),s(this,"createTimeout",()=>{this.boxVisibleTimeoutId||(this.boxVisibleTimeoutId=window.setTimeout(this.handleTimeout,this.visibleTimeLeft))}),s(this,"clearTimeout",()=>{this.boxVisibleTimeoutId&&(window.clearTimeout(this.boxVisibleTimeoutId),this.boxVisibleTimeoutId=null)}),s(this,"handleTimeout",()=>{var e;null===(e=this.boxVisibleCallback)||void 0===e||e.call(this),this.cleanup()}),s(this,"cleanup",()=>{var e;this.clearTimeout(),null===(e=this.observer)||void 0===e||e.disconnect(),this.boxVisibleCallback=void 0,document.removeEventListener("visibilitychange",this.handleVisibilityChange)}),this.baseNode=e,this.observer=new IntersectionObserver(this.handleIntersection,n)}onBoxVisible(e){this.boxVisibleCallback=e}observe(){this.observer.observe(this.baseNode),document.addEventListener("visibilitychange",this.handleVisibilityChange)}}window.opbox.component.register({prototypeName:"allegro.expandableAdvertisement"},class{constructor({baseNode:e,props:t}){s(this,"startExpandAnimation",()=>{this.expandButton&&this.expandButton.hasAttribute("disabled")||(this.showExpanderContent(),this.foldButton&&(this.foldButton.style.pointerEvents="auto",this.foldButton.setAttribute("disabled","")),this.expandedImage&&(this.expandedImage.style.display="block"),this.advertisementWrapper.style.top=`-${this.collapsedHeight}px`,this.advertisementWrapper.style.transition=".4s",this.advertisement.style.transition=".4s",this.advertisement.style.height=this.expandedHeight+this.collapsedHeight+"px",this.disableStickyHeader())}),s(this,"showCollapseButtonAnimation",()=>{this.mainWrapper.style.transition=".4s",this.advertisementWrapper.style.removeProperty("top"),this.advertisement.style.height=this.collapsedHeight+"px"}),s(this,"prepareFoldAnimation",()=>{window.requestAnimationFrame(this.showCollapseButtonAnimation)}),s(this,"startFoldAnimation",()=>{this.foldButton&&this.foldButton.hasAttribute("disabled")||(this.expandButton&&(this.expandButton.style.pointerEvents="auto",this.expandButton.classList.remove("mpof_5r"),this.expandButton.setAttribute("disabled","")),this.foldButton&&this.foldButton.classList.add("mpof_5r"),this.disableStickyHeader(),window.requestAnimationFrame(this.prepareFoldAnimation))}),s(this,"onAnimationEnd",e=>{if("top"===e.propertyName&&e.target===this.advertisementWrapper){this.isExpanded?this.onFoldAnimationEnd():this.onExpandAnimationEnd();const e=window.document.createEvent("Event");e.initEvent("resize",!0,!0),window.dispatchEvent(e)}}),this.baseNode=e,this.props=t;const{collapsedImage:i,expandedImage:a={},expandedBox:n={}}=this.props,o=window.document.body,r=o.querySelector(".main-wrapper"),d=this.baseNode.querySelector('[data-role="opbox-expandable-advertisement"]'),l=this.baseNode.querySelector('[data-main-wrapper="advertisement-expanded"]'),h=this.baseNode.querySelector('[data-role="opbox-expandable-advertisement-collapsed"]');if(this.collapsedHeight=i.imageHeight,this.expandedHeight=a.imageHeight||n.boxHeight||i.imageHeight,this.trackersExist=!1,this.isExpanded=!1,![o,r,d,l,h].every(Boolean))throw this.hide(),Error("Invalid allegro.expandableAdvertisement component initialization");this.pageBody=o,this.mainWrapper=r,this.allegroHeader=window.document.querySelector('[data-prototype-id="allegro.metrumHeader"]'),this.advertisement=d,this.advertisementWrapper=l,this.collapsedImageNode=h,this.foldButton=this.baseNode.querySelector('[data-role="opbox-expandable-advertisement-collapse-button"]'),this.expandedImage=this.baseNode.querySelector('[data-role="opbox-expandable-advertisement-expanded"]'),this.expandButton=this.baseNode.querySelector('[data-role="opbox-expandable-advertisement-expand-button"]'),this.expandedHeight=Math.abs(this.expandedHeight)-Math.abs(this.collapsedHeight),this.insertBox(),this.setMainWrapperAttribute(),this.configureBoxViewEvents()}insertBox(){const e=window.document.querySelector('[data-prototype-id="allegro.expandableAdvertisement"]');null!==e&&this.pageBody.insertBefore(e,this.pageBody.firstChild)}configureBoxViewEvents(){const e=new o(this.baseNode);e.onBoxVisible(()=>{return e=this.baseNode,void window.opbox.analytics.sendEvent({contextNode:e,action:"boxViewMrc"});var e}),e.observe()}setMainWrapperAttribute(){this.mainWrapper.setAttribute("data-main-wrapper","advertisement-expanded")}hide(){this.baseNode.classList.add("mpof_5r")}onMount(){const{collapsedImage:e}=this.props;this.attachClickEvent(),e.imageTrackers&&a(this.baseNode,e.imageTrackers)}disableStickyHeader(){this.allegroHeader&&this.allegroHeader.setAttribute("data-dropdown-open","")}enableStickyHeader(){this.allegroHeader&&this.allegroHeader.removeAttribute("data-dropdown-open")}showExpanderContent(){const{expandedImage:e={}}=this.props;this.expandButton&&this.expandButton.classList.add("mpof_5r"),this.foldButton&&this.foldButton.classList.remove("mpof_5r"),this.trackersExist||(e.imageTrackers&&a(this.baseNode,e.imageTrackers),this.trackersExist=!0)}onExpandAnimationEnd(){this.foldButton&&this.foldButton.removeAttribute("disabled"),this.advertisement.style.height=this.expandedHeight+this.collapsedHeight+"px",this.isExpanded=!0,this.enableStickyHeader()}onFoldAnimationEnd(){this.expandButton&&this.expandButton.removeAttribute("disabled"),this.advertisement.style.height=this.collapsedHeight+"px",this.expandedImage&&(this.expandedImage.style.display="none"),this.isExpanded=!1,this.enableStickyHeader()}attachClickEvent(){this.expandButton&&this.expandButton.addEventListener("click",this.startExpandAnimation),this.foldButton&&this.foldButton.addEventListener("click",this.startFoldAnimation),this.advertisementWrapper.addEventListener("transitionend",this.onAnimationEnd,!1)}})}}));
//# sourceMappingURL=index.es6_f882ee3b.js.map