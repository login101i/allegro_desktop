((e,t)=>{for(var i in t)e[i]=t[i]})(window,(e=>{var t={};function i(s){if(t[s])return t[s].exports;var o=t[s]={i:s,l:!1,exports:{}};return e[s].call(o.exports,o,o.exports,i),o.l=!0,o.exports}return i.m=e,i.c=t,i.d=(e,t,s)=>{i.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:s})},i.r=e=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},i.t=(e,t)=>{if(1&t&&(e=i(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var s=Object.create(null);if(i.r(s),Object.defineProperty(s,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var o in e)i.d(s,o,(t=>e[t]).bind(null,o));return s},i.n=e=>{var t=e&&e.__esModule?()=>e.default:()=>e;return i.d(t,"a",t),t},i.o=(e,t)=>({}.hasOwnProperty.call(e,t)),i.p="https://assets.allegrostatic.com/sc-11136/",i(i.s=0)})({0(e,t,i){e.exports=i("WdQY")},THUx(e,t){e.exports={SlotEventType:{ON_RENDER:0,ON_VIEW:1}}},WdQY(e,t,i){i.r(t);var s=i("rRL6"),o=i.n(s);function r(e,t,i){return t in e?Object.defineProperty(e,t,{value:i,enumerable:!0,configurable:!0,writable:!0}):e[t]=i,e}var n=i("THUx");let a,l;function d(e){const{path:t}=e||{};return t&&0!==t.length?t.map(e=>e.id).filter(e=>e.length<=20).join("_"):""}(e=>{e[e.BANNER=0]="BANNER",e[e.SKYSCROLL=1]="SKYSCROLL",e[e.PARALLAX=2]="PARALLAX",e[e.UNDER_PRICE=3]="UNDER_PRICE"})(a||(a={})),(e=>{e.LEFT="left",e.CENTER="center",e.RIGHT="right"})(l||(l={}));const h=e=>{const[t,i]=e.split("x");return[+t,+i]};function c(e){var t,i;return{viewport:e.viewport,sizes:null!==(t=null===(i=e.sizes)||void 0===i?void 0:i.map(h))&&void 0!==t?t:[]}}function p(e){var t,i;return null!==(t=null==e||null===(i=e.traits)||void 0===i?void 0:i.map(e=>`${e.hash}_${e.value}`))&&void 0!==t?t:[]}function u(e){return"BOUGHT"===e.status||"PARTIALLY_BOUGHT"===e.status}function v(e){return e&&"BOUGHT"===e.status}function g(e){if(!e)return;const t=[];return e.orders.filter(u).forEach(e=>{e.offers.filter(v).forEach(e=>{t.push((e=>e.category.path.reduce((e,{id:t})=>`${e}${e?"_":""}${t}`,""))(e))})}),t}function f(e){return e.reduce((e,t)=>{return[...e,...(i=e,s=t.sizes,s.filter(([e,t])=>!i.some(([i,s])=>e===i&&t===s)))];var i,s},[])}function y(e,t){window.opbox.analytics.sendEvent({contextNode:e,action:"itemView",customParams:t.getResponseInformation()})}let m=!1;class S{constructor({rawUserTraits:e,tagId:t,services:i,responsiveMappings:s,targetingProps:o}){r(this,"slot",null),r(this,"setupOnClickEvent",()=>{window.addEventListener("blur",()=>setTimeout(this.handleWindowBlur,0))}),r(this,"getGoogletagService",()=>this.services.get("@allegro/opbox-googletag-service")),r(this,"applySlotConfiguration",e=>{((e,t)=>{const i=googletag.sizeMapping();t.forEach(({viewport:e,sizes:t})=>{i.addSize([e.width,e.height],t)}),e.defineSizeMapping(i.build())})(e,this.responsiveMappings),this.setTargeting(e)}),r(this,"handleWindowBlur",()=>{var e,t;this.slotWasClicked()&&(e=this.adNode,t=this.slot,e&&window.opbox.analytics.sendEvent({contextNode:e,action:"click",customParams:null==t?void 0:t.getResponseInformation()}))}),this.services=i,this.tagId=t,this.responsiveMappings=s,this.targetingProps=o,this.setupOnClickEvent(),(e=>{if(m||!e)return;const t={profile:{profile:{traits:(e=>Object.fromEntries(e.map(({hash:e,value:t})=>[e,t])))(e.traits)}},lastUpdate:new Date};localStorage.setItem("pl_allegro_user_profile",JSON.stringify(t)),m=!0})(e)}refresh(e=!1){this.getGoogletagService().then(t=>{e&&(this.adNode.style.position="static"),t.refreshSlot(this.tagId)})}setTargeting(e){this.setQueryParametersTargeting(e);const{userTraits:t,erotic:i,categoryPath:s,offerId:o,ordersCategoryPaths:r,offerImage:n,offerPrice:a,offerTitle:l}=this.targetingProps;e.setTargeting("profil",t),s.length>0&&e.setTargeting("cat",s),"boolean"==typeof i&&e.setTargeting("ertc",i?"1":"0"),o&&e.setTargeting("offerId",o),n&&e.setTargeting("offerImage",n),r&&e.setTargeting("cat",r),a&&e.setTargeting("offerPrice",a),l&&e.setTargeting("offerTitle",l)}slotWasClicked(){var e;const{activeElement:t}=window.document,i=null===(e=this.adNode)||void 0===e?void 0:e.querySelector("iframe");return"IFRAME"===(null==t?void 0:t.nodeName)&&t===i}setQueryParametersTargeting(e){const t=(()=>{const e=new URL(window.location.href);return[...new Set(e.searchParams.keys())].map(t=>{const i=e.searchParams.getAll(t);return[t,1===i.length?i[0]:i]})})();t&&t.forEach(([t,i])=>e.setTargeting("q_"+t,i))}}const b=(e,t,i)=>{let s={userTraits:t.userTraits,categoryPath:t.categoryPath};return i.forEach(e=>{t[e]&&(s=Object.assign({},s,{[e]:t[e]}))}),{rawUserTraits:t.rawUserTraits,tagId:t.tagId,responsiveMappings:t.responsiveMappings,services:e,targetingProps:s}},w={root:null,rootMargin:"-61px 0px 0px 0px",threshold:[.01,.9999]};class E{constructor(e,t){var i,s;r(this,"baseNodeYPosition",null),r(this,"footerVisible",!1),r(this,"skyscrollSticky",!1),r(this,"resizeObserver",null),r(this,"skyscrollObserver",null),r(this,"footerObserver",null),r(this,"checkIfScrolledAboveBaseNode",()=>{this.isScrollPositionAboveBaseNode()&&this.unsetSticky()}),r(this,"scrollListenerCallback",(i=this.checkIfScrolledAboveBaseNode,s=0,function(){for(var e=[],t=arguments.length;t--;)e[t]=arguments[t];var o=Date.now();s+200<=o&&(s=o,i.apply(void 0,e))})),r(this,"attachScrollListener",()=>{window.addEventListener("scroll",this.scrollListenerCallback)}),r(this,"removeScrollListener",()=>{this.scrollListenerCallback&&window.removeEventListener("scroll",this.scrollListenerCallback)}),r(this,"isScrollPositionAboveBaseNode",()=>{var e;return window.scrollY<(null!==(e=this.baseNodeYPosition)&&void 0!==e?e:0)-200}),r(this,"handleSkyscrollIntersectionWithHeader",e=>{e.forEach(e=>{e.boundingClientRect.top<61&&!this.footerVisible?this.setSticky():this.unsetSticky()})}),r(this,"handleFooterVisibilityInViewport",e=>{e.forEach(e=>{e.isIntersecting?(this.footerVisible=!0,this.unsetStickyStyles(),this.removeScrollListener()):(this.footerVisible=!1,this.skyscrollSticky&&!this.isScrollPositionAboveBaseNode()&&this.setSticky())})}),r(this,"handleWindowResize",e=>{e.forEach(e=>{e.contentRect.width<1024&&(this.unsetSticky(),this.disconnectObservers())})}),this.node=e,this.footerNode=t,this.bodyNode=document.body,this.parentNode=this.node.parentElement,this.resizeObserverSupported="ResizeObserver"in window,this.viewportDesktop=document.documentElement.clientWidth>=1024}initialize(e){this.viewportDesktop&&this.resizeObserverSupported&&(this.baseNodeYPosition=e,this.registerObservers())}setSticky(){this.setStickyStyles(),this.attachScrollListener(),this.skyscrollSticky=!0}unsetSticky(){this.unsetStickyStyles(),this.removeScrollListener(),this.skyscrollSticky=!1}registerObservers(){this.resizeObserver=new ResizeObserver(this.handleWindowResize),this.footerObserver=new IntersectionObserver(this.handleFooterVisibilityInViewport),this.skyscrollObserver=new IntersectionObserver(this.handleSkyscrollIntersectionWithHeader,w)}connectObservers(){var e,t,i;null===(e=this.resizeObserver)||void 0===e||e.observe(this.bodyNode),null===(t=this.footerObserver)||void 0===t||t.observe(this.footerNode),null===(i=this.skyscrollObserver)||void 0===i||i.observe(this.parentNode)}disconnectObservers(){var e,t,i;null===(e=this.footerObserver)||void 0===e||e.disconnect(),null===(t=this.skyscrollObserver)||void 0===t||t.disconnect(),null===(i=this.resizeObserver)||void 0===i||i.disconnect()}setStickyStyles(){this.node.classList.add("_d0a4b_okHfs","mp7g_oz")}unsetStickyStyles(){this.node.classList.remove("_d0a4b_okHfs","mp7g_oz")}}function N(e){var t,i,s,o,r,n,a,l,d,h,c;const{buyNow:p,advertisement:u,auction:v}=e;return null!==(t=null!==(i=null!==(s=null!==(o=null==p||null===(r=p.price)||void 0===r||null===(n=r.original)||void 0===n?void 0:n.amount)&&void 0!==o?o:null==p||null===(a=p.price)||void 0===a||null===(l=a.sale)||void 0===l?void 0:l.amount)&&void 0!==s?s:null==u||null===(d=u.price)||void 0===d?void 0:d.amount)&&void 0!==i?i:null==v||null===(h=v.price)||void 0===h||null===(c=h.current)||void 0===c?void 0:c.amount)&&void 0!==t?t:null}window.opbox.component.register({prototypeName:"allegro.advertisement.slot.banner",clientImplementationVersion:o.a},class extends S{constructor({services:e,props:t}){super(b(e,t,["erotic","ordersCategoryPaths"])),r(this,"initialized",!1),r(this,"onEvent",e=>{const{scaleToFitContainer:t}=this.props;switch(e.type){case n.SlotEventType.ON_RENDER:{const i=e.event.size;this.slot=e.event.slot,this.applyAdHeight(i),t&&i&&this.scaleToFitContainer(i);break}case n.SlotEventType.ON_VIEW:y(this.adNode,e.event.slot)}}),this.props=t;const i=document.getElementById(t.tagId);if(!i)throw Error("Couldn't find the ad node");this.adNode=i}onMount(){this.props.visible&&this.initialize()}onUnmount(){this.initialized&&this.destroy()}onUpdate(e){this.props=((e,{unitPath:t,responsiveMappings:i,alignment:s,erotic:o,scaleToFitContainer:r,visible:n,marginBottom:l,userTraits:h,categoryData:u,reserveSpace:v,orders:f})=>({type:a.BANNER,tagId:e,unitPath:t,responsiveMappings:i.map(c),alignment:s,erotic:o,scaleToFitContainer:r,visible:n,marginBottom:l,userTraits:p(h),rawUserTraits:h,reserveSpace:v,categoryPath:d(u),ordersCategoryPaths:g(f)}))(this.props.tagId,e),this.props.visible?(!this.initialized&&this.initialize(),this.initialized&&this.refresh()):this.initialized&&this.destroy()}initialize(){const{tagId:e,unitPath:t,responsiveMappings:i}=this.props,{clientWidth:s,clientHeight:o}=document.documentElement,r=((e,t,i)=>i.reverse().find(({viewport:i})=>i.height<=t&&i.width<=e))(s,o,i);r&&0!==r.sizes.length?(this.getGoogletagService().then(s=>{s.defineSlot({tagId:e,unitPath:t,size:f(i),slotConfigurationCallback:this.applySlotConfiguration,onEvent:this.onEvent})}),this.show(),this.initialized=!0):this.hide()}destroy(){this.hide(),this.getGoogletagService().then(e=>{e.destroySlot(this.props.tagId),this.adNode.innerHTML=""}),this.initialized=!1}show(){var e,t;null===(e=this.adNode.parentElement)||void 0===e||null===(t=e.classList)||void 0===t||t.replace("mpof_5r","mpof_ki")}hide(){var e,t;null===(e=this.adNode.parentElement)||void 0===e||null===(t=e.classList)||void 0===t||t.replace("mpof_ki","mpof_5r")}applyAdHeight(e){const{parentElement:t}=this.adNode;if(t){if(!e)return t.style.height="0px",void(t.style.overflow="hidden");t.style.height=e[1]+"px",t.style.overflow="visible"}}scaleToFitContainer([e,t]){var i;const{parentElement:s}=this.adNode;if(!s)return;const o=(null!==(i=s.offsetWidth)&&void 0!==i?i:0)-e;if(o<0){const i=(e+o)/e,r=i*t;this.adNode.style.transform=`scale(${i})`,s.style.height=r+"px",s.style.alignItems="center"}}}),window.opbox.component.register({prototypeName:"allegro.advertisement.slot.skyscroll",clientImplementationVersion:o.a},class extends S{constructor({services:e,props:t,baseNode:i}){super(b(e,t,["erotic"])),r(this,"initialized",!1),r(this,"onEvent",e=>{e.type===n.SlotEventType.ON_VIEW&&y(this.adNode,e.event.slot),e.type===n.SlotEventType.ON_RENDER&&(this.slot=e.event.slot)}),this.props=t;const s=document.getElementById(t.tagId);if(!s)throw Error("Couldn't find the ad node");this.adNode=s,this.baseNode=i;const o=document.querySelector('.site-footer,[data-box-name="metrum-footer-partial"],[data-box-name="layout.container.footer"]');o?(this.stickyBehaviour=new E(this.adNode,o),this.stickyBehaviour.initialize(this.baseNode.getBoundingClientRect().y)):(window.opbox.reportError(Error("Couldn't find the footer. It does not exist on page or selector has changed.")),this.stickyBehaviour=null)}onMount(){this.props.visible&&this.initializeSlot()}onUnmount(){this.initialized&&this.destroySlot()}beforeOnUpdate(){var e;null===(e=this.stickyBehaviour)||void 0===e||e.unsetSticky()}onUpdate(e){this.props=((e,t)=>{let{responsiveMappings:i,categoryData:s,userTraits:o}=t,r=((e,t)=>{if(null==e)return{};var i,s,o={},r=Object.keys(e);for(s=0;s<r.length;s++)i=r[s],t.indexOf(i)>=0||(o[i]=e[i]);return o})(t,["responsiveMappings","categoryData","userTraits"]);return Object.assign({},r,{type:a.SKYSCROLL,tagId:e,responsiveMappings:i.map(c),categoryPath:d(s),userTraits:p(o),rawUserTraits:o})})(this.props.tagId,e),this.props.visible?(!this.initialized&&this.initializeSlot(),this.initialized&&this.refreshSlot()):this.initialized&&this.destroySlot()}initializeSlot(){const{tagId:e,unitPath:t}=this.props;this.getGoogletagService().then(i=>{i.defineSlot({tagId:e,unitPath:t,size:f(this.props.responsiveMappings),slotConfigurationCallback:this.applySlotConfiguration,onEvent:this.onEvent})}),this.show(),this.initialized=!0}destroySlot(){var e;this.hide(),null===(e=this.stickyBehaviour)||void 0===e||e.unsetSticky(),this.getGoogletagService().then(e=>{e.destroySlot(this.props.tagId),this.adNode.innerHTML=""}),this.initialized=!1}show(){var e,t,i;null===(e=this.adNode.parentElement)||void 0===e||null===(t=e.classList)||void 0===t||t.replace("mpof_5r","mpof_ki"),null===(i=this.stickyBehaviour)||void 0===i||i.connectObservers()}hide(){var e,t,i;null===(e=this.adNode.parentElement)||void 0===e||null===(t=e.classList)||void 0===t||t.replace("mpof_ki","mpof_5r"),null===(i=this.stickyBehaviour)||void 0===i||i.disconnectObservers()}refreshSlot(){this.getGoogletagService().then(e=>{e.refreshSlot(this.props.tagId)})}}),window.opbox.component.register({prototypeName:"allegro.advertisement.slot.parallax",clientImplementationVersion:o.a},class extends S{constructor({services:e,props:t}){super(b(e,t,["offerId","erotic"])),r(this,"slotSize",null),r(this,"onEvent",e=>{e.type===n.SlotEventType.ON_VIEW&&y(this.adNode,e.event.slot),e.type===n.SlotEventType.ON_RENDER&&(this.slot=e.event.slot,this.slotSize=e.event.size,this.adClipNode.classList.add("_d0a4b_3sUK2"),this.scaleToFitContainer())}),r(this,"scaleToFitContainer",()=>{var e;if(!this.slotSize)return this.adNode.style.transform="scale(1) perspective(0)",this.wrapperNode.style.height="0px",this.wrapperNode.style.overflow="hidden",void(this.adNode.style.position="static");const[t,i]=this.slotSize,s=(t+((null!==(e=this.wrapperNode.offsetWidth)&&void 0!==e?e:0)-t))/t,o=Math.floor(s*i);this.wrapperNode.style.height=o+"px",this.adNode.style.transform=`scale(${s}) perspective(0)`,this.adNode.style.position="fixed",this.wrapperNode.style.overflow="visible"}),this.props=t;const i=document.getElementById(t.tagId),s=document.getElementById(t.tagId+"-ad-clip"),o=document.getElementById(t.tagId+"-wrapper");if(!i||!s||!o)throw Error("Couldn't find the ad node");this.adNode=i,this.adClipNode=s,this.wrapperNode=o}onMount(){this.initialize(),window.addEventListener("resize",this.scaleToFitContainer)}onUnmount(){this.destroy(),window.removeEventListener("resize",this.scaleToFitContainer),this.wrapperNode.style.height="auto"}onUpdate(e){this.props=((e,{unitPath:t,responsiveMappings:i,categoryData:s,erotic:o,userTraits:r,offerId:n})=>({type:a.PARALLAX,tagId:e,unitPath:t,responsiveMappings:i.map(c),erotic:o,categoryPath:d(s),userTraits:p(r),rawUserTraits:r,offerId:n}))(this.props.tagId,e),this.refresh(!0)}initialize(){const{tagId:e,unitPath:t}=this.props;this.getGoogletagService().then(i=>{i.defineSlot({tagId:e,unitPath:t,size:f(this.props.responsiveMappings),slotConfigurationCallback:this.applySlotConfiguration,onEvent:this.onEvent})})}destroy(){this.getGoogletagService().then(e=>{e.destroySlot(this.props.tagId)})}}),window.opbox.component.register({prototypeName:"allegro.advertisement.slot.underPrice",clientImplementationVersion:o.a},class extends S{constructor({services:e,props:t}){super(b(e,t,["offerId","offerImage","offerPrice","offerTitle"])),r(this,"slotSize",null),r(this,"onEvent",e=>{e.type===n.SlotEventType.ON_VIEW&&y(this.adNode,e.event.slot),e.type===n.SlotEventType.ON_RENDER&&(this.slotSize=e.event.size,this.slot=e.event.slot,this.scaleToFitContainer())}),r(this,"scaleToFitContainer",()=>{var e;const{parentElement:t}=this.adNode;if(!t||!this.slotSize)return;const[i,s]=this.slotSize,o=(null!==(e=t.offsetWidth)&&void 0!==e?e:0)-i;if(o<0){const e=(i+o)/i,r=e*s;this.adNode.style.transform=`scale(${e})`,t.style.height=r+"px",t.style.alignItems="center"}else t.style.alignItems=""}),this.props=t;const i=document.getElementById(t.tagId);if(!i)throw Error("Couldn't find the ad node");this.adNode=i}onMount(){this.initialize(),window.addEventListener("resize",this.scaleToFitContainer)}onUnmount(){this.destroy(),window.removeEventListener("resize",this.scaleToFitContainer)}onUpdate(e){this.props=((e,{unitPath:t,responsiveMappings:i,alignment:s,userTraits:o,offerData:r})=>{var n,l,d;return{type:a.UNDER_PRICE,tagId:e,unitPath:t,responsiveMappings:i.map(c),alignment:s,userTraits:p(o),rawUserTraits:o,offerId:r.id,offerTitle:r.name,offerImage:null!==(n=null===(l=r.images[0])||void 0===l?void 0:l.url)&&void 0!==n?n:null,offerPrice:N(r.sellingMode),categoryPath:(d=r.breadcrumbs,d&&0!==d.length?d.map(e=>e.id).filter(e=>e&&e.length<=20).join("_"):"")}})(this.props.tagId,e),this.refresh()}initialize(){const{tagId:e,unitPath:t}=this.props;this.getGoogletagService().then(i=>{i.defineSlot({tagId:e,unitPath:t,size:f(this.props.responsiveMappings),slotConfigurationCallback:this.applySlotConfiguration,onEvent:this.onEvent})})}destroy(){this.getGoogletagService().then(e=>{e.destroySlot(this.props.tagId)})}})},rRL6(e,t){e.exports="585"}}));
//# sourceMappingURL=index.es6_fed45e2c.js.map