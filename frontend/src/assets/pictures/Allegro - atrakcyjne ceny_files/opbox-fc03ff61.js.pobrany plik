var attach=function(e){function t(e){return(t="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function n(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function r(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function i(e,t,n){return t&&r(e.prototype,t),n&&r(e,n),e}function o(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function a(e){return(a=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function s(e,t){return(s=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function c(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}function u(e,t,n){return(u=c()?Reflect.construct:function(e,t,n){var r=[null];r.push.apply(r,t);var i=new(Function.bind.apply(e,r));return n&&s(i,n.prototype),i}).apply(null,arguments)}function l(e){var t="function"==typeof Map?new Map:void 0;return(l=function(e){if(null===e||(n=e,-1===Function.toString.call(n).indexOf("[native code]")))return e;var n;if("function"!=typeof e)throw new TypeError("Super expression must either be null or a function");if(void 0!==t){if(t.has(e))return t.get(e);t.set(e,r)}function r(){return u(e,arguments,a(this).constructor)}return r.prototype=Object.create(e.prototype,{constructor:{value:r,enumerable:!1,writable:!0,configurable:!0}}),s(r,e)})(e)}function d(e,t){if(null==e)return{};var n,r,i=function(e,t){if(null==e)return{};var n,r,i={},o=Object.keys(e);for(r=0;r<o.length;r++)n=o[r],t.indexOf(n)>=0||(i[n]=e[n]);return i}(e,t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);for(r=0;r<o.length;r++)n=o[r],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(i[n]=e[n])}return i}function h(e,t){if(t&&("object"==typeof t||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e)}function f(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var n=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null==n)return;var r,i,o=[],a=!0,s=!1;try{for(n=n.call(e);!(a=(r=n.next()).done)&&(o.push(r.value),!t||o.length!==t);a=!0);}catch(e){s=!0,i=e}finally{try{a||null==n.return||n.return()}finally{if(s)throw i}}return o}(e,t)||p(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function v(e){return function(e){if(Array.isArray(e))return m(e)}(e)||function(e){if("undefined"!=typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}(e)||p(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function p(e,t){if(e){if("string"==typeof e)return m(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?m(e,t):void 0}}function m(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}var g=Object.assign,y=Object.values,b=JSON.parse;function k(e){return Array.isArray(e)}function w(e){return"object"===t(e)&&!k(e)&&null!==e}function E(e){return"string"==typeof e}function C(e){return void 0===e}function P(e){return"function"==typeof e}function x(e){return null===e||"object"!==t(e)||0===Object.keys(e).length}function S(e,t){if(null==e)throw"Cannot convert undefined or null to object";return Array.from(e,t)}function N(e,t,n){return e?S(e.querySelectorAll(t),n):[]}function A(e,t){return e?e.querySelector(t):null}function I(e,t){return e.hasAttribute(t)}function R(e,t){return e.getAttribute(t)}function O(e){return R(e,"data-prototype-id")}function M(e){return R(e,"data-box-id")}function T(e){return R(e,"data-box-name")}function j(e){return R(e,"data-civ")}function W(e,t){for(var n=arguments.length,r=new Array(n>2?n-2:0),i=2;i<n;i++)r[i-2]=arguments[i];return g.apply(void 0,[e.createElement(t)].concat(r))}function V(e,t){return e.insertAdjacentElement("beforebegin",t)}function B(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"";return e.includes("/metrum/")}function L(e){return E(e)?e.split("/metrum/")[1].split("/")[0]:""}function U(){}function H(e,t,n){var r;return function(){for(var i=arguments.length,o=new Array(i),a=0;a<i;a++)o[a]=arguments[a];var s=this,c=function(){r=null,n||e.apply(s,o)},u=n&&!r;return clearTimeout(r),r=setTimeout(c,t),u&&e.apply(s,o),r}}function D(e,t,n){var r=n.createEvent("CustomEvent");r.initCustomEvent(t,!0,!0,{}),e.dispatchEvent(r)}function z(e,t){return e.concat(t)}function F(e,n){for(var r=arguments.length,i=new Array(r>2?r-2:0),o=2;o<r;o++)i[o-2]=arguments[o];if(0===i.length)return e=n;var a=i,s=a.shift();return(e="object"!==t(e)?{}:e)[s]=F.apply(void 0,[e[s],n].concat(a)),e}function q(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:function(){return!1};Object.keys(e).forEach((function(n){Object.prototype.hasOwnProperty.call(e,n)&&t(n,e[n])&&delete e[n]}))}var _=/Version\/[\d.]+.*Safari/,J=/iPhone|iPad|iPod|Android/i;var G=function(e){return function(t,n){return Object.assign({},t,{},e(n))}},X=function(e,t,n){return e.addEventListener(t,n)};function Y(e){return"noModule"in e.document.createElement("script")}function K(e){return'<link type="text/css" rel="stylesheet" crossorigin="" href="'.concat(e,'"/>')}function Q(e){return e.textContent}var $=function(e,n,r,i,o,a){var s=new XMLHttpRequest;return s.open(e,n,!0),Object.keys(i).forEach((function(e){s.setRequestHeader(e,i[e])})),s.withCredentials=o,s.upload&&a&&s.upload.addEventListener("progress",a),s.send(function(e,n){return["POST","PUT","PATCH"].includes(e)?"object"!==t(n)||n instanceof Blob||n instanceof FormData?n:JSON.stringify(n):null}(e,r)),s},Z=function(e){return e>=200&&e<=204},ee=function(e,t,n,r){var i=e.status,o=e.responseText,a=t(i),s=function(e){return e.split("\n").reduce((function(e,t){var n=t.indexOf(":"),r=t.substr(0,n).trim().toLowerCase(),i=t.substr(n+1).trim();return r&&(e[r]=e[r]?"".concat(e[r],", ").concat(i):i),e}),{})}(e.getAllResponseHeaders()),c={};try{c=b(o)}catch(e){c=o}a?n({status:i,data:c,headers:s}):r({status:i,data:c,message:"Request failed with status code ".concat(i),headers:s})},te=function(){var e=null,t=function(t,n,r,i){var o=i.headers,a=void 0===o?{}:o,s=i.validateStatus,c=void 0===s?Z:s,u=i.withCredentials,l=void 0!==u&&u,d=i.cancelLast,h=void 0!==d&&d,f=i.onUploadProgress;h&&null!==e&&e.abort();var v=$(t,n,r,a,l,f);return e=v,function(e,t){return new Promise((function(n,r){e.readyState===XMLHttpRequest.DONE?ee(e,t,n,r):e.onreadystatechange=function(){e.readyState===XMLHttpRequest.DONE&&(ee(e,t,n,r),e.onreadystatechange=null)}}))}(v,c).finally((function(){e=null}))};return{request:t,get:function(e){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return t("GET",e,{},n)},post:function(e,n,r){return t("POST",e,n,r)},put:function(e,n,r){return t("PUT",e,n,r)},patch:function(e,n,r){return t("PATCH",e,n,r)},delete:function(e){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return t("DELETE",e,{},n)}}},ne=function(e){return e.opbox||{}},re=function(e,t){e.opbox=e.opbox||{},g(e.opbox,t)},ie=function(){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},r=t.targetWindow;n(this,e),this.targetWindow=r}return i(e,[{key:"document",get:function(){return this.targetWindow.document}}]),e}(),oe=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&s(e,t)}(o,e);var t,r,i=(t=o,r=c(),function(){var e,n=a(t);if(r){var i=a(this).constructor;e=Reflect.construct(n,arguments,i)}else e=n.apply(this,arguments);return h(this,e)});function o(e){var t;return n(this,o),(t=i.call(this,e)).message=e,t.name="PageRenderingError",t}return o}(l(Error)),ae=function(){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},r=t.data,i=t.headers;n(this,e),this.data=r,this.headers=i}return i(e,[{key:"valid",get:function(){return w(this.data)}}]),e}(),se=function(){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};n(this,e),this.dataSources=t}return i(e,[{key:"resolve",value:function(e,t){var n=e.value;if("DATA_SOURCE"===e.type){var r=this.dataSources[n];return Object.assign({},r&&r.data&&o({},t,r.data),{},r&&!x(r.metadata)&&o({},"".concat(t,".$meta"),r.metadata))}return o({},t,n)}}]),e}(),ce=function(){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},r=t.boxes,i=void 0===r?{}:r,o=t.boxNameToIdMap,a=void 0===o?{}:o,s=t.dataSources,c=void 0===s?{}:s,u=t.meta,l=void 0===u?{}:u;n(this,e),this.boxes=i,this.boxNameToIdMap=a,this.dataSources=c,this.meta=l,this.parameterResolver=new se(this.dataSources)}return i(e,[{key:"resolved",get:function(){return{boxes:this.resolvedBoxes,boxNameToIdMap:this.boxNameToIdMap,dataSources:this.dataSources,meta:this.meta}}},{key:"resolvedBoxes",get:function(){var e=this,t=this.pageProperties;return function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this,t=arguments.length>1?arguments[1]:void 0,n=arguments.length>2?arguments[2]:void 0,r={};return Object.keys(e).forEach((function(i){r[i]=t.call(n,e[i],i,e)})),r}(this.boxes,(function(n){var r=Object.keys(n).reduce((function(t,r){var i=e.parameterResolver.resolve(n[r],r);return g(t,i)}),{});return g(r,t)}))}},{key:"pageProperties",get:function(){var e={};for(var t in this.meta)0===t.indexOf("$page.")&&(e[t]=this.meta[t]);return e}}]),e}();function ue(e,t){var n=new URLSearchParams(e.search);return Object.entries(t).map((function(e){var t=f(e,2),r=t[0],i=t[1];return Array.isArray(i)?(n.delete(r),i.forEach((function(e){return n.append(r,e)}))):n.set(r,i),n})),n}function le(e){var t=e.href,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},r=new URL(t);return r.search=ue(r,n).toString(),r.toString()}function de(e){return e>=200&&e<300||502===e}function he(e){return!!e.match(new RegExp("^(\\/[a-zA-Z0-9\\-]+)*\\/{0,1}$"))}var fe=function(){function e(t){var r=t.targetWindow,i=void 0===r?window:r,o=t.httpClient,a=t.reportError,s=t.fragmentRenderCallback,c=t.boxRenderCallback;n(this,e),this.httpClient=o,this.reportError=a,this.targetWindow=i,this.fragmentRenderCallback=s,this.boxRenderCallback=c,this.render={box:this.renderBox.bind(this),fragment:this.renderFragment.bind(this)}}return i(e,[{key:"getPageData",value:function(e){var t={headers:{Accept:"application/vnd.opbox-web.v2+json"},cancelLast:!0,validateStatus:de};return this.httpClient.get(e,t).then((function(e){var t=new ae(e);if(!t.valid)throw new oe("Opbox response is invalid.");return new ce(t.data)}))}},{key:"handleError",value:function(e){return this.reportError(new Error(e)),Promise.reject(e)}},{key:"renderSubtree",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=e.boxId,n=e.additionalQueryParameters,r=void 0===n?{}:n,i=e.isPlaceholder,o=void 0!==i&&i;return this.targetWindow.console.warn("Warning: renderSubtree method is deprecated and will be removed soon. Use render.box method instead."),this.renderBox({boxId:t,additionalQueryParameters:r,isPlaceholder:o})}},{key:"renderBox",value:function(){var e=this,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},n=t.boxId,r=t.additionalQueryParameters,i=void 0===r?{}:r,o=t.isPlaceholder,a=void 0!==o&&o;return n?this.httpClient.get(le(this.targetWindow.location,i),{headers:{Accept:"application/vnd.opbox-web.subtree+json","x-box-id":n},cancelLast:!1,validateStatus:de}).then((function(t){var r=t.data;return e.boxRenderCallback({boxId:n,data:r,isPlaceholder:a})})):this.handleError("Missing 'boxId' property!")}},{key:"renderFragment",value:function(){var e=this,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},n=t.pathname,r=t.additionalQueryParameters,i=void 0===r?{}:r;if(!n)return this.handleError("Missing 'pathname' property!");if(!he(n))return this.handleError("Invalid 'pathname' property!");var o=this.targetWindow.location,a=o.protocol,s=o.host,c=new URL("".concat(a,"//").concat(s).concat(n)),u=c.href;return this.httpClient.get(le({href:u},i),{headers:{Accept:"application/vnd.opbox-web.subtree+json"},cancelLast:!1,validateStatus:de}).then((function(t){var r=t.data;return e.fragmentRenderCallback({pathname:n,data:r})}))}},{key:"createAPI",value:function(){return{renderSubtree:this.renderSubtree.bind(this),render:this.render}}}]),e}(),ve=function(){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},r=t.meta,i=void 0===r?{}:r,o=arguments.length>1?arguments[1]:void 0;n(this,e),this.appContext=o,this.meta=i}return i(e,[{key:"updateMetaRobots",value:function(){var e=this.appContext.document.querySelector('head meta[name="robots"]');e&&this.meta&&e.setAttribute("content",[this.meta.noindexCondition?"noindex":"index",this.meta.nofollowCondition?"nofollow":"follow"].join(", "))}},{key:"render",value:function(){this.updateMetaRobots()}}]),e}(),pe=function(){function e(t){var r=t.appContext,i=t.analytics,o=t.updateComponentCallback,a=void 0===o?U:o,s=t.beforeUpdateComponentCallback,c=void 0===s?U:s;n(this,e),this.appContext=r,this.rawData=new ce,this.listeners={},this.analytics=i,this.updateComponentCallback=a,this.beforeUpdateComponentCallback=c}return i(e,[{key:"registerListener",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:U,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:U;if(this.rawData.boxes[e]){var r=this.rawData.resolved.boxes[e];setTimeout((function(){t(r)}),0)}this.listeners[e]={onChange:t,onProgress:n}}},{key:"triggerChangeListener",value:function(e){var t=this;this.rawData=e;var n=this.rawData.resolved,r=n.boxes,i=n.boxNameToIdMap,o=n.meta,a=o.defaultCustomParams;this.analytics&&this.analytics.updateCustomParams(a),Object.entries(r).forEach((function(e){var n=f(e,2),r=n[0],i=n[1];C(i)||t.updateComponentCallback(r,i)})),Object.keys(i).forEach((function(e){var n=r[i[e]];if(!C(n)){var o=t.listeners[e];o&&P(o.onChange)&&setTimeout((function(){return o.onChange(n)}),0)}})),new ve({meta:o},this.appContext).render()}},{key:"triggerProgressListener",value:function(){var e=this;this.beforeUpdateComponentCallback(),Object.keys(this.listeners).forEach((function(t){var n=e.listeners[t];n&&P(n.onProgress)&&setTimeout((function(){return n.onProgress()}),0)}))}}]),e}();"undefined"!=typeof globalThis?globalThis:"undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self&&self;var me=function(e,t){return e(t={exports:{}},t.exports),t.exports}((function(e,t){e.exports=function(){function e(e){return e instanceof Object&&e.constructor===Object}function t(n,r){var i=n,o=r;e(n)||(i={}),e(r)||(o={});var a=Object.keys(i),s=Object.keys(o),c={};return a.forEach((function(n){-1!==s.indexOf(n)?null===i[n]?c[n]=o[n]:e(i[n])&&e(o[n])?c[n]=t(i[n],o[n]):c[n]=o[n]:c[n]=i[n]})),s.forEach((function(e){-1===a.indexOf(e)&&(c[e]=o[e])})),c}return function(n){var r=n;e(n)||(r={});for(var i=arguments.length,o=new Array(i>1?i-1:0),a=1;a<i;a++)o[a-1]=arguments[a];return o.forEach((function(n){e(n)&&(r=t(r,n))})),r}}()})),ge=function(e){return N(e,"[".concat("data-analytics-enabled","]"))},ye=function(e){var t=N(e,"[".concat("data-analytics-proxied","]")).reduce((function(e,t){var n=ge(t).filter((function(t){return!e.includes(t)}));return n.length?z(e,n):e}),[]);return ge(e).filter((function(e){return!t.includes(e)}))},be=new WeakMap,ke=new WeakMap,we=function(e){return be.has(e)},Ee=function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;if(e&&!we(e)){var r=parseInt(ke.get(e),10)||0,i=r+t;i>=n&&(be.set(e,!0),D(e,"boxView",e.ownerDocument)),ke.set(e,i)}},Ce=function(e,t,n,r){return e>0?e<n?t<n?t-e:n-e:0:t<0?0:t<n?t:r},Pe=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"",t=arguments.length>1?arguments[1]:void 0;return e.slice(0,t)},xe=function(){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},r=t.targetWindow,i=t.send;n(this,e),this.window=r,this.send=i,this.counter=0}return i(e,[{key:"handleError",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=e.error,n=void 0===t?{}:t,r=n.name,i=n.message,o=n.stack;this.counter<100&&(this.counter+=1,this.send({type:r,message:Pe(i,800),stack:Pe(o,800)}))}},{key:"initialize",value:function(){X(this.window,"error",this.handleError.bind(this))}}]),e}(),Se=function(e,t){for(var n,r={},i=0;i<e.attributes.length;i+=1){var o=e.attributes[i];if(0===o.name.indexOf(t)){var a=o.name.replace(t,"");r[(n=a,n.replace(/^([A-Z])|[\s|_-](\w)/g,(function(e,t,n){return n?n.toUpperCase():t.toLowerCase()})))]=o.value}}return r},Ne=function(e){var t=e.contextNode,n=e.customParams,r=void 0===n?{}:n,i=Se(t,"data-analytics-view-opbox-custom-"),o=Object.keys(i).length?{_opbox:i}:{};return me(Se(t,"data-analytics-view-custom-"),o,r)},Ae=function(e){var t=e.contextNode,n=e.coordinates,r=void 0===n?{}:n,i=e.destinationUrl,o=void 0===i?"":i,a=e.customParams,s=void 0===a?{}:a,c=e.isNewTab,u=c?{isNewTab:c}:{},l=Object.assign({},Se(t,"data-analytics-click-opbox-custom-"),{destinationUrl:o},u,{},r);return me(Se(t,"data-analytics-click-custom-"),{_opbox:l},s)},Ie=function(e){var t=e.contextNode,n=e.customParams,r=void 0===n?{}:n,i=Se(t,"data-analytics-interaction-custom-"),o=Se(t,"data-analytics-interaction-opbox-custom-"),a=Object.keys(o).length?{_opbox:o}:{};return me(i,a,r)},Re=function(e){var t=e.closest("[".concat("data-analytics-tags","]"));if(!t)return[];var n,r,i,o,a=!!t.closest("[".concat("data-item","]"))?function(e){var t=e&&e.closest("[".concat("data-box-name","][").concat("data-analytics-tags","]"));return t&&R(t,"data-analytics-tags")||""}(t):"",s=R(t,"data-analytics-tags")||"";return n=s,r=a.split(","),i=n.split(","),(o=r.concat(i)).filter((function(e,t){return e&&o.indexOf(e)===t}))},Oe=function(e){var t=e.closest("[data-analytics-groups]");if(t){var n=decodeURIComponent(R(t,"data-analytics-groups"));try{n=b(n)}catch(e){return console.log("JSON.parse error! Can not convert ".concat(n," to JSON.")),[]}return n}return[]},Me=function(e,t,n){return X(e,t,n),function(){e.removeEventListener(t,n)}},Te=function(){function e(t){var r=t.targetWindow,i=t.config,o=t.cookieMonsterClient,a=t.boxViewsMarker,s=t.sendPerformanceMetrics;n(this,e);var c=i.cookieMonster,u=(c=void 0===c?{}:c).isEngagementMeasuringEnabled,l=c.isErrorReporterEnabled,d=c.defaultCustomParams,h=void 0===d?{}:d;this.targetWindow=r,this.document=this.targetWindow.document,this.isEngagementMeasuringEnabled=u,this.isErrorReporterEnabled=l,this.cookieMonsterClient=o,this.boxViewsMarker=a,this.defaultCustomParams=h,this.eventCallbacks=[],this.sendPerformanceMetrics=s||U,this.errorReporter=new xe({targetWindow:r,send:this.sendErrorEvent.bind(this)});var f=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=e.navigator,n=(t=void 0===t?{}:t).userAgent,r=void 0===n?"":n;return r}(r);this.isMobile=function(e){return!!e.match(J)}(f),this.isSafari=function(e){return!!e.match(_)}(f),this.isFirefox=function(e){return e.toLowerCase().includes("firefox")}(f)}return i(e,[{key:"initialize",value:function(){var e=this;this.cookieMonsterClient.initialize(),this.isEngagementMeasuringEnabled&&Promise.resolve().then((function(){return Tt})).then((function(t){(0,t.attachEngagementObserver)({targetWindow:e.targetWindow,onCycleComplete:e.sendPingEvent.bind(e)})})),this.isErrorReporterEnabled&&this.errorReporter.initialize(),this.eventHandlers=[Me(this.document,"change",this.handleChange.bind(this)),Me(this.document,"click",this.handleClick.bind(this)),Me(this.document,"mousedown",this.handleLinkClick.bind(this)),Me(this.document,"submit",this.handleSubmit.bind(this)),Me(this.document,"contextmenu",this.handleClick.bind(this)),Me(this.document,"boxView",this.handleBoxView.bind(this)),Me(this.targetWindow,"DOMContentLoaded",this.detectAdblock.bind(this))]}},{key:"teardown",value:function(){this.eventHandlers.forEach((function(e){e()}))}},{key:"callEventCallbacks",value:function(e){this.eventCallbacks.length&&this.eventCallbacks.forEach((function(t){return t(e)}))}},{key:"sendEvent",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=e.contextNode,n=e.action,r=e.label,i=void 0===r?"":r,o=e.value,a=e.customParams,s=void 0===a?{}:a;if(!t||!n)return{};var c=t.closest("[data-analytics-category]").getAttribute("data-analytics-category"),u=T(t.closest("[data-box-name]")),l=t.closest("[data-box-id]"),d=l&&M(l),h=Re(t),f=Oe(t),v=h.length?{analyticsTags:h}:{},p=f.length?{groups:f}:{},m=d?{boxName:u,boxId:d}:{boxName:u},g=Object.assign({},v,{},p,{},m),y=me(Object.assign({},s),{_opbox:g},this.defaultCustomParams.ev),b={category:c,action:n,label:i,value:o,customParams:y};return this.cookieMonsterClient.send("event",b),this.callEventCallbacks(b),b}},{key:"sendPingEvent",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=e.engagementTime,n=e.scrollBottom,r=e.pageHeight,i={category:"Engagement",label:"ping",customParams:{et:t,sb:n,ph:r}};this.cookieMonsterClient.send("event",i),this.callEventCallbacks(i)}},{key:"sendErrorEvent",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=e.type,n=e.message,r=e.stack,i={category:"BrowserError",label:t,value:n,customParams:{st:r}};this.cookieMonsterClient.send("event",i),this.callEventCallbacks(i)}},{key:"sendClickEvent",value:function(e){this.sendEvent(Object.assign({},e,{action:"click"}))}},{key:"sendContextmenuEvent",value:function(e){this.sendEvent(Object.assign({},e,{action:"contextmenu"}))}},{key:"sendBoxInteractionEvent",value:function(e){this.sendEvent(Object.assign({},e,{action:"boxInteraction"}))}},{key:"sendItemViewEvent",value:function(e){this.sendEvent(Object.assign({},e,{action:"itemView"}))}},{key:"sendBoxViewEvent",value:function(e){this.sendEvent(Object.assign({},e,{action:"boxView"}))}},{key:"sendFormSubmitEvent",value:function(e){this.sendEvent(Object.assign({},e,{action:"submit"}))}},{key:"detectAdblock",value:function(){var e=this,t=W(this.document,"div",{innerHTML:"&nbsp;",className:"adsbox"});this.document.body.appendChild(t),this.targetWindow.setTimeout((function(){var n=0!==t.offsetHeight;e.cookieMonsterClient.send("event",{category:"clearPV",action:n,customParams:e.defaultCustomParams.ev}),e.document.body.removeChild(t)}),100)}},{key:"handleClick",value:function(e){this.handleBoxInteraction(e),this.handleLinkClick(e)}},{key:"handleBoxInteraction",value:function(e){if("function"==typeof e.target.closest){var t=e.target.closest("[data-analytics-interaction]");if(t){var n=Ie({contextNode:t}),r=R(t,"data-analytics-interaction-label")||"",i=R(t,"data-analytics-interaction-value")||Q(t).trim();this.sendBoxInteractionEvent({contextNode:t,label:r,value:i,customParams:n})}}}},{key:"shouldHandleBoxInteraction",value:function(e){return"mousedown"===e.type&&!this.isMobile&&(this.isSafari||this.isFirefox)&&"select-one"===e.target.type}},{key:"handleLinkClick",value:function(e){if("function"==typeof e.target.closest)if(this.shouldHandleBoxInteraction(e))this.handleBoxInteraction(e);else{var t=e.target.closest("a");if(t&&I(t,"data-analytics-clickable")){var n=R(t,"data-analytics-click-label")||"",r=R(t,"data-analytics-click-value")||Q(t).trim(),i="_blank"===R(t,"target"),o=R(t,"href"),a=e.pageX?{pageX:e.pageX,pageY:e.pageY}:{};"click"!==e.type||0!==e.button?"contextmenu"!==e.type?"mousedown"===e.type&&1===e.button&&this.sendClickEvent({contextNode:t,label:n,value:r,customParams:Ae({contextNode:t,coordinates:a,destinationUrl:o,isNewTab:!0})}):this.sendContextmenuEvent({contextNode:t,label:n,value:r,customParams:Ae({contextNode:t,coordinates:a,destinationUrl:o})}):this.sendClickEvent({contextNode:t,label:n,value:r,customParams:Ae({contextNode:t,coordinates:a,destinationUrl:o,isNewTab:i||e.metaKey||e.ctrlKey})})}}}},{key:"handleChange",value:function(e){var t=e.target;if("select-one"===t.type&&t&&I(t,"data-analytics-selectable")){var n=t.options[t.selectedIndex].value,r=Se(t,"data-analytics-select-custom-");this.sendEvent({contextNode:t,action:"change",value:n,customParams:r})}}},{key:"handleSubmit",value:function(e){var t=e.target;if(t&&"FORM"===t.nodeName&&I(t,"data-analytics-submittable")){var n=R(t,"action"),r=S(t.elements).filter((function(e){return e.name})).map((function(e){return{name:e.name,value:e.value}})).sort((function(e,t){return e.name.toLowerCase().localeCompare(t.name.toLowerCase())})).map((function(e){return"".concat(e.name,"=").concat(e.value)})).join("&"),i=(r=r?"?".concat(r):"")?n+r:n;i=encodeURI(i),this.sendFormSubmitEvent({contextNode:t,value:i,label:"submitForm"})}}},{key:"markParentBoxAsVisible",value:function(e){var t=e.parentNode&&e.parentNode.closest("[data-analytics-enabled]");this.boxViewsMarker&&t&&!we(t)&&this.boxViewsMarker.markBoxAsVisible(t,!0)}},{key:"handleBoxView",value:function(e){var t=e.target;if(t&&I(t,"data-analytics-enabled")&&!S(t.childNodes).some((function(e){return e.classList&&e.classList.contains("opbox-fragment")}))){var n=R(t,"data-analytics-view-value")||"",r=R(t,"data-analytics-view-label")||"",i=Ne({contextNode:t});if(t.firstChild&&t.firstChild.nodeType===Node.ELEMENT_NODE&&(i=Object.assign({},i,{},Se(t.firstChild,"data-analytics-view-custom-"))),I(t,"data-item"))return this.markParentBoxAsVisible(t),void this.sendItemViewEvent({contextNode:t,label:r,value:n,customParams:i});i=Object.assign({},i,{},function(e){if(!e)return{};var t=R(e,"data-analytics-box-view-custom-params");if(!t)return{};var n={};try{n=b(decodeURIComponent(t))}catch(e){console.log(e)}return n}(t)),this.sendBoxViewEvent({contextNode:t,value:n,customParams:i})}}},{key:"sendPageViewProxy",value:function(){this.sendPerformanceMetrics(),this.cookieMonsterClient.sendPageView(this.defaultCustomParams.pv),this.cookieMonsterClient.updateReferrer()}},{key:"sendEventProxy",value:function(e,t,n,r,i){return e.nodeType===Node.ELEMENT_NODE?this.sendEvent({value:n,label:i,action:t,contextNode:e,customParams:r}):this.sendEvent(e)}},{key:"sendItemViewEventProxy",value:function(e){var t=e.contextNode,n=e.label,r=e.value,i=e.customParams;this.sendItemViewEvent({contextNode:t,label:n,value:r,customParams:Ne({contextNode:t,customParams:i})})}},{key:"sendClickEventProxy",value:function(e){var t=e.contextNode,n=e.label,r=e.value,i=e.customParams,o=e.destinationUrl,a=e.isNewTab;if(a&&"boolean"!=typeof a)throw new Error("isNewTab property must be boolean");this.sendClickEvent({contextNode:t,label:n,value:r,customParams:Ae({contextNode:t,destinationUrl:o,customParams:i,isNewTab:a})})}},{key:"sendContextmenuEventProxy",value:function(e){var t=e.contextNode,n=e.label,r=e.value,i=e.customParams,o=e.destinationUrl;this.sendContextmenuEvent({contextNode:t,label:n,value:r,customParams:Ae({contextNode:t,destinationUrl:o,customParams:i})})}},{key:"sendBoxInteractionEventProxy",value:function(e){var t=e.contextNode,n=e.label,r=e.value,i=e.customParams;this.sendBoxInteractionEvent({contextNode:t,label:n,value:r,customParams:Ie({contextNode:t,customParams:i})})}},{key:"updateCustomParams",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=e.pv,n=void 0===t?{}:t,r=e.ev,i=void 0===r?{}:r;w(n)&&w(i)?this.defaultCustomParams={pv:n,ev:i}:console.log("Can not update custom params with non-object arguments!")}},{key:"registerEventCallback",value:function(e){e&&!this.eventCallbacks.includes(e)&&this.eventCallbacks.push(e)}},{key:"createAPI",value:function(){return{sendPageView:this.sendPageViewProxy.bind(this),sendEvent:this.sendEventProxy.bind(this),sendItemViewEvent:this.sendItemViewEventProxy.bind(this),sendClickEvent:this.sendClickEventProxy.bind(this),sendContextmenuEvent:this.sendContextmenuEventProxy.bind(this),sendBoxInteractionEvent:this.sendBoxInteractionEventProxy.bind(this),registerEventCallback:this.registerEventCallback.bind(this)}}}]),e}();function je(e){return w(e)&&!("clientImplementationVersion"in e)?Object.assign(e,{clientImplementationVersion:""}):e}function We(e){var t=e.instance,n=e.method,r=e.reportError,i=e.data,o=void 0===i?null:i,a=e.onSuccess,s=void 0===a?function(){}:a;if(t&&P(t[n]))try{t[n](o),s()}catch(e){r(e)}}function Ve(e,t){return""===t?e:"".concat(e,"@").concat(t)}var Be=function(){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},r=t.targetWindow,i=t.services,o=t.reportError,a=t.unmountNodeCallback,s=t.mountNodeCallback,c=t.componentNodesFinder,u=t.serializedPropsFinder,l=t.registerPrototypeCallback;n(this,e),this.targetWindow=r,this.services=i,this.implementations=new Map,this.instances=new Map,this.boxDataCache=new Map,this.reportError=o,this.unmountNodeCallback=a,this.mountNodeCallback=s,this.registerPrototypeCallback=l,this.serializedPropsFinder=u,this.componentNodesFinder=c}return i(e,[{key:"unmountNode",value:function(e){var t=this;this.unmountNodeCallback(e),N(e,"div[data-prototype-id]").concat([e]).forEach((function(e){var n=M(e)||T(e);We({instance:t.instances.get(n),method:"onUnmount",reportError:t.reportError}),t.instances.set(n,null)}))}},{key:"mountNode",value:function(e){var t=this;N(e,"div[data-prototype-id]").concat([e]).forEach((function(e){var n=O(e),r=j(e)||"";t.registerInstancesForPrototype(n,r,[e])})),this.mountNodeCallback(e)}},{key:"isPrototypeObjectValid",value:function(e){var n=e.prototypeName,r=e.clientImplementationVersion;return"prototypeName"in e?""===n?(this.reportError(new Error('Property "prototypeName" cannot be empty string')),!1):E(n)?!!E(r)||(this.reportError(new Error('Property "clientImplementationVersion" must be string but got '.concat(t(r)))),!1):(this.reportError(new Error('Property "prototypeName" must be string but got '.concat(t(n)))),!1):(this.reportError(new Error('Property "handledPrototype" must have "prototypeName" field')),!1)}},{key:"containsValidPrototypes",value:function(e){var t=this;return 0===e.length?(this.reportError(new Error("Empty handledPrototypes list")),!1):!e.filter((function(e){return!t.isPrototypeObjectValid(e)})).length}},{key:"isPrototypeValid",value:function(e){return k(e)?this.containsValidPrototypes(e):w(e)?this.isPrototypeObjectValid(e):(this.reportError(new Error('"handledPrototype" argument must be an object or an array')),!1)}},{key:"isImplementationValid",value:function(e){return P(e)?e.prototype.onUpdate&&!P(e.prototype.onUpdate)?(this.reportError(new Error('"onUpdate" property must be a function or undefined but got '.concat(t(e.prototype.onUpdate)))),!1):!!P(e.prototype.onMount)||(this.reportError(new Error('"implementation" class has to have "onMount" method')),!1):(this.reportError(new Error('"implementation" must be a class')),!1)}},{key:"registerInstancesForPrototype",value:function(e,t,n){var r=this.implementations.get(Ve(e,t));r&&(this.registerInstances(n,this.services.getServicesForComponent(e),r),this.registerPrototypeCallback(e,t))}},{key:"registerImplementationAndInstances",value:function(e,t){var n=e.prototypeName,r=e.clientImplementationVersion,i=Ve(n,r),o=""===r;this.implementations.has(i)?this.reportError(new Error("".concat(n," ").concat(o?"":"with ".concat(r," client implementation version "),"already registered!"))):(this.implementations.set(i,t),this.registerInstancesForPrototype(n,r,this.componentNodesFinder.find(n,r)))}},{key:"updateComponentCallback",value:function(e,t){var n=this.instances.get(e);n?We({instance:n,method:"onUpdate",reportError:this.reportError,data:t}):this.boxDataCache.set(e,t)}},{key:"beforeUpdateComponentCallback",value:function(){var e=this;this.instances.forEach((function(t){return We({instance:t,method:"beforeOnUpdate",reportError:e.reportError})}))}},{key:"registerInstances",value:function(e,t,n){var r=this;e.forEach((function(e){if(!R(e,"data-pathname")){var i=T(e),o=M(e),a=r.serializedPropsFinder.getPropsForBox(o,i),s=new n({baseNode:e,props:a,services:t}),c=o||i;r.instances.get(c)||(We({instance:s,method:"onMount",reportError:r.reportError,onSuccess:function(){r.instances.set(c,s)}}),r.boxDataCache.has(c)&&(We({instance:s,method:"beforeOnUpdate",reportError:r.reportError}),r.updateComponentCallback(c,r.boxDataCache.get(c)),r.boxDataCache.delete(c)))}}))}},{key:"register",value:function(e,t){var n=this,r=function(e){return k(e)?e.map(je):je(e)}(e);this.isPrototypeValid(r)&&this.isImplementationValid(t)&&(k(r)?r.forEach((function(e){n.registerImplementationAndInstances(e,t)})):this.registerImplementationAndInstances(r,t))}},{key:"createPublicAPI",value:function(){return{register:this.register.bind(this)}}},{key:"createPrivateAPI",value:function(){var e=this;return{updateComponentCallback:this.updateComponentCallback.bind(this),beforeUpdateComponentCallback:this.beforeUpdateComponentCallback.bind(this),unmountNode:this.unmountNode.bind(this),mountNode:this.mountNode.bind(this),updateSerializedPropsCollection:function(){e.serializedPropsFinder.updateNodesCollection()},updateComponentNodesCollection:function(){e.componentNodesFinder.updateNodesCollection()}}}}]),e}(),Le="script[".concat("data-serialize-box-id","], script[").concat("data-serialize-box-name","]"),Ue=function(){function e(t,r){n(this,e),this.targetWindow=t,this.reportError=r,this.collection=[],this.updateNodesCollection()}return i(e,[{key:"updateNodesCollection",value:function(){this.collection=N(this.targetWindow.document,Le)}},{key:"getNodeByBoxId",value:function(e){return this.collection.find((function(t){return R(t,"data-serialize-box-id")===e}))}},{key:"getNodeByBoxName",value:function(e){return this.collection.find((function(t){return R(t,"data-serialize-box-name")===e}))}},{key:"getPropsFromNode",value:function(e){if(!e)return{};try{return b(Q(e))}catch(e){return this.reportError(e),{}}}},{key:"getPropsForBox",value:function(e,t){var n=this.getNodeByBoxId(e)||this.getNodeByBoxName(t);return n?this.getPropsFromNode(n):{}}}]),e}(),He=function(e,t){return function(e,n){var r=e.prototypeName;r&&n({domNodes:t.find(r)})}},De=["Content-Type"],ze=function(){return Promise.reject(new Error("missing edge host"))},Fe=function(){function e(t){var r=t.httpClient,i=t.edgeHost,o=t.language;n(this,e),this.edgeHost=i,this.httpClient=r,this.defaultHeaders={"Content-Type":"application/vnd.allegro.public.v1+json",Accept:"application/vnd.allegro.public.v1+json","Accept-Language":o}}return i(e,[{key:"prepareRequestSettings",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(e.disableDefaultHeaders)return e;var n=this.normalizeSettings(e),r=this.defaultHeaders,i=(r["Content-Type"],d(r,De));return me({},t?{headers:i}:{headers:this.defaultHeaders},n)}},{key:"normalizeSettings",value:function(e){if(!e||!e.headers)return e;var n=function e(n,r){return Object.keys(n).reduce((function(i,o){var a=n[o],s="object"===t(a)?e(a,r):a;return i[r.find((function(e){return o.toLowerCase()===e.toLowerCase()}))||o]=s,i}),{})}(e.headers,Object.keys(this.defaultHeaders));return g(e,{headers:n})}},{key:"prepareRequestUrl",value:function(e){return this.edgeHost+e}},{key:"get",value:function(e,t){return this.httpClient.get(this.prepareRequestUrl(e),this.prepareRequestSettings(t,!0))}},{key:"put",value:function(e,t,n){return this.httpClient.put(this.prepareRequestUrl(e),t,this.prepareRequestSettings(n))}},{key:"post",value:function(e,t,n){return this.httpClient.post(this.prepareRequestUrl(e),t,this.prepareRequestSettings(n))}},{key:"patch",value:function(e,t,n){return this.httpClient.patch(this.prepareRequestUrl(e),t,this.prepareRequestSettings(n))}},{key:"delete",value:function(e,t){return this.httpClient.delete(this.prepareRequestUrl(e),this.prepareRequestSettings(t,!0))}},{key:"createAPI",value:function(){return this.edgeHost?{get:this.get.bind(this),put:this.put.bind(this),post:this.post.bind(this),patch:this.patch.bind(this),delete:this.delete.bind(this)}:{get:ze,put:ze,post:ze,patch:ze,delete:ze}}}]),e}(),qe=function(){function e(t){var r=t.targetWindow,i=t.alias,o=void 0===i?"cm":i,a=t.config,s=void 0===a?{}:a,c=t.isExternal,u=void 0!==c&&c;n(this,e);var l=s.cookieMonster,d=l.host,h=l.account,f=l.defaultCustomParams,v=void 0===f?{}:f,p=l.referrer,m=void 0===p?document.referrer:p;this.targetWindow=r,this.document=this.targetWindow.document,this.alias=o,this.host=d,this.account=h,this.isExternal=u,this.defaultCustomParams=v,this.referrer=m}return i(e,[{key:"initialize",value:function(){if(this.isExternal)return this.loadExternal(),void this.callCookieMonster.call(this,"create",this.account);this.host&&this.account&&!this.isLoaded()?(this.load(),this.callCookieMonster.call(this,"create",this.account),this.sendPageView(),this.updateReferrer()):this.updateReferrer()}},{key:"load",value:function(){this.isLoaded()||function(e,t,n,r,i){e["cm.analytics.object"]=i,e[i]=e[i]||function(){for(var t=arguments.length,n=new Array(t),r=0;r<t;r++)n[r]=arguments[r];(e[i].q=e[i].q||[]).push(n)};var o=W(t,"script",{src:r}),a=t.getElementsByTagName("script")[0];a.parentNode.insertBefore(o,a)}(this.targetWindow,this.document,0,this.host,this.alias)}},{key:"loadExternal",value:function(){this.isLoaded()||function(e,t){e["cm.analytics.object"]=t,e[t]=e[t]||function(){for(var n=arguments.length,r=new Array(n),i=0;i<n;i++)r[i]=arguments[i];(e[t].q=e[t].q||[]).push(r)}}(this.targetWindow,this.alias)}},{key:"send",value:function(){for(var e,t=arguments.length,n=new Array(t),r=0;r<t;r++)n[r]=arguments[r];(e=this.callCookieMonster).call.apply(e,[this,this.sendCommand()].concat(n))}},{key:"sendPageView",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.defaultCustomParams.pv||{};this.send("pageview",{customParams:e,referrer:this.referrer})}},{key:"updateReferrer",value:function(){this.referrer=window.location.href}},{key:"callCookieMonster",value:function(){if(this.isLoaded()){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];this.targetWindow[this.alias].apply(null,t)}}},{key:"isLoaded",value:function(){return"function"==typeof this.targetWindow[this.alias]}},{key:"sendCommand",value:function(){return"send@".concat(this.account)}}]),e}(),_e=function(){function e(t){var r,i,o,a,s=t.targetWindow,c=t.boxes,u=void 0===c?[]:c,l=t.significantElementSizePercentage,d=void 0===l?.75:l,h=t.timeoutValue,f=void 0===h?500:h,v=t.debounceTimeoutValue,p=void 0===v?20:v;n(this,e),this.targetWindow=s,this.config={timeoutValue:f,debounceTimeoutValue:p,significantElementSizePercentage:d},this.resetState(),this.boxes=u.length?u:ye(s.document),this.visibleElements=[],this.visibleElementsByIntersectionObserver=new Set,this.notVisibleElements=new Set,this.observer=new this.targetWindow.IntersectionObserver(this.intersectionHandler.bind(this),{threshold:d}),this.scrollHandlerWithContext=this.scrollHandler.bind(this),this.scrollEndHandler=H(this.resetCurrentlyVisibleElementsAfterScroll,this.config.debounceTimeoutValue),this.resetCurrentlyVisibleElementsOnTimeout=(r=this.resetCurrentlyVisibleElements.bind(this),i=this.config.debounceTimeoutValue,function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];var s=this;return new Promise((function(e){var n=o&&!a;clearTimeout(a),a=setTimeout((function(){a=null,o||e(r.apply(s,t))}),i),n&&e(r.apply(s,t))}))}),this.markCurrentlyVisibleElementsAsSeenOnTimeout=H(this.markCurrentlyVisibleElementsAsSeen.bind(this),this.config.timeoutValue)}return i(e,[{key:"resetState",value:function(){var e=(new Date).getTime();this.state={isScrolling:!1,scrollStartTime:e,counterStartTime:e}}},{key:"markPreviouslyVisibleElementsAsSeen",value:function(){var e=this,t=(new Date).getTime();this.visibleElements.forEach((function(n){Ee(n,t-e.state.counterStartTime,e.config.timeoutValue)}))}},{key:"markPreviouslyVisibleElementsAsSeenAfterScroll",value:function(){var e=this;this.visibleElements.forEach((function(t){Ee(t,e.state.scrollStartTime-e.state.counterStartTime,e.config.timeoutValue)}))}},{key:"markCurrentlyVisibleElementsAsSeen",value:function(){var e=this.config.timeoutValue;this.visibleElements.forEach((function(t){Ee(t,e,e)}))}},{key:"intersectionHandler",value:function(e){var t=this;e.forEach((function(e){var n=e.target,r=e.boundingClientRect,i=e.rootBounds;i&&function(e,t,n){var r=e.right-e.left,i=e.bottom-e.top,o=Ce(e.left,e.right,t.width,r);return Ce(e.top,e.bottom,t.height,i)*o/(r*i)>n}(r,i,t.config.significantElementSizePercentage)?(t.visibleElementsByIntersectionObserver.add(n),t.notVisibleElements.delete(n),D(n,"inViewport",t.targetWindow.document)):t.visibleElementsByIntersectionObserver.has(n)?(t.visibleElementsByIntersectionObserver.delete(n),D(n,"outOfViewport",t.targetWindow.document)):t.notVisibleElements.add(n)})),this.resetCurrentlyVisibleElementsOnTimeout()}},{key:"resetCurrentlyVisibleElements",value:function(){var e=this;this.markPreviouslyVisibleElementsAsSeen(),this.visibleElements=[],this.visibleElementsByIntersectionObserver.forEach((function(t){return e.visibleElements.push(t)})),this.markCurrentlyVisibleElementsAsSeenOnTimeout(),this.resetState()}},{key:"resetCurrentlyVisibleElementsAfterScroll",value:function(){var e=this;this.markPreviouslyVisibleElementsAsSeenAfterScroll(),this.notVisibleElements.forEach((function(t){e.observer.unobserve(t),e.observer.observe(t)})),this.markCurrentlyVisibleElementsAsSeenOnTimeout(),this.resetState()}},{key:"scrollHandler",value:function(){this.state.isScrolling||(this.state.scrollStartTime=(new Date).getTime(),this.state.isScrolling=!0),clearTimeout(this.markCurrentlyVisibleElementsAsSeenOnTimeout()),this.scrollEndHandler()}},{key:"addBox",value:function(e){null!==e&&-1===this.boxes.indexOf(e)&&(this.boxes.push(e),this.observer.observe(e))}},{key:"isBoxInViewport",value:function(e){return this.visibleElementsByIntersectionObserver.has(e)}},{key:"markBoxAsRendered",value:function(e){var t=this;return I(e,"data-analytics-enabled")&&this.addBox(e),ye(e).forEach((function(e){return t.addBox(e)})),Promise.resolve()}},{key:"markBoxAsVisible",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(this.addBox(e),t){var n=this.config.timeoutValue;Ee(e,n,n)}}},{key:"recursivelyMarkBoxAsVisible",value:function(e){var t=this,n=arguments.length>1&&void 0!==arguments[1]&&arguments[1];this.markBoxAsVisible(e,n),ye(e).forEach((function(e){return t.markBoxAsVisible(e,n)}))}},{key:"removeBox",value:function(e){var t;null!==e&&(t=e,be.delete(t),ke.delete(t),this.boxes=this.boxes.filter((function(t){return t!==e})),this.visibleElements=this.visibleElements.filter((function(t){return t!==e})),this.observer.unobserve(e))}},{key:"markBoxAsHidden",value:function(e){this.removeBox(e),this.resetCurrentlyVisibleElementsOnTimeout()}},{key:"unmountNode",value:function(e){var t=this;ge(e).forEach((function(e){return t.removeBox(e)}))}},{key:"recursivelyMarkBoxAsHidden",value:function(e){var t=this;this.markBoxAsHidden(e),ye(e).forEach((function(e){return t.markBoxAsHidden(e)}))}},{key:"trackBoxScroll",value:function(e){X(e,"scroll",this.scrollHandlerWithContext)}},{key:"initialize",value:function(){var e=this;X(this.targetWindow,"scroll",this.scrollHandlerWithContext),this.boxes.forEach((function(t){return e.observer.observe(t)}))}},{key:"createAPI",value:function(){return{markBoxAsRendered:this.markBoxAsRendered.bind(this),markBoxAsVisible:this.markBoxAsVisible.bind(this),recursivelyMarkBoxAsVisible:this.recursivelyMarkBoxAsVisible.bind(this),markBoxAsHidden:this.markBoxAsHidden.bind(this),recursivelyMarkBoxAsHidden:this.recursivelyMarkBoxAsHidden.bind(this),trackBoxScroll:this.trackBoxScroll.bind(this),isBoxInViewport:this.isBoxInViewport.bind(this)}}}]),e}(),Je=function(e){return function(t){0===t.status||(e.newrelic?(console.error("Reporting error to newrelic: ".concat(t.message)),e.newrelic.noticeError(t)):console.error("Error: ".concat(t.message)),e.opbox.plugin.get("sentry").then((function(e){return e.captureException(t)})).catch(U))}};var Ge=function(e,t){function n(e){for(var t,n,r,i,o=new RegExp("([^&=]+)=?([^&]*)","g"),a={},s=e.substring(e.indexOf("?")+1,e.length);t=o.exec(s);)n=a,r=decodeURIComponent(t[1]),i=decodeURIComponent("string"===t[1]?t[2].replace(/\+/g," "):t[2]),void 0===n[r]?n[r]=[i]:n[r].push(i);return a}var r,i=n(e),o=function(e,t){for(var n=0,r=e.length;n<r;n+=1)if(t(e[n],n,e))return e[n];return null}(i,function(e){return function(t){return t.name===e}}("route"));function a(e){t.forEach((function(t){return n=e,r=t.name,i=t.value,void(n[r]=Array.isArray(i)?i:[i]);var n,r,i}))}function s(e){return Object.keys(e).map((function(t){return e[t].map((function(e){return[t,e]}))})).reduce(z,[]).reduce((function(e,t){var n=f(t,2),r=n[0],i=n[1];return null!=i?"".concat(e).concat((e?"&":"?")+encodeURIComponent(r),"=").concat(encodeURIComponent(i)):e}),"")}return o&&0===o.value.indexOf("http")?(a(r=2===o.value.split("?").length?n(o.value.split("?")[1]):[]),o.value=o.value.split("?")[0]+s(r)):a(i),s(i)},Xe=function(){function e(t){var r=t.targetWindow,i=t.opboxWebClient,o=t.rawDataListenersRegistry,a=t.reportError;n(this,e);var s=r.location;this.targetWindow=r,this.opboxWebClient=i,this.rawDataListenersRegistry=o,this.reportError=a,this.history=[s.pathname],this.lastFetchPath=s.pathname+s.search,this.changeCallbacks=[],this.changeStateCallbacks=[]}return i(e,[{key:"initialize",value:function(){var e=this;this.targetWindow.onpopstate=function(t){return e.handlePopState(t)},this.targetWindow.history.replaceState({opboxjs:!0},"")}},{key:"isInternalNavigation",value:function(e){return this.history.find((function(t){return t===e}))}},{key:"navigateRelative",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=t.persistHash,r=void 0!==n&&n,i=this.targetWindow.location,o=i.pathname,a=i.search,s=i.hash,c=r?s:"",u=o+a+c,l=e.filter((function(e){return!e.fetchUrlOnly})),d=o+Ge(a,l)+c,h=o+Ge(a,e)+c;return h!==this.lastFetchPath&&this.fetch(h),d!==u&&(this.changeUrl(d),this.history.push(o),this.changeCallbacks.forEach((function(e){return e()})),this.targetWindow.performance.mark("clientSideNavigationStart")),d}},{key:"refreshPage",value:function(){var e=this.targetWindow.location,t=e.pathname+e.search;this.fetch(t)}},{key:"changeUrl",value:function(e){this.targetWindow.history.pushState("","",e)}},{key:"changeState",value:function(e){var t=e.queryParameters,n=e.hash,r=e.shouldChangeHistory;if(!t&&!E(n))return this.reportError(new Error("New parameters (array) or hash (string) required")),null;var i,o=this.targetWindow.location,a=o.pathname,s=o.search,c=o.hash,u=a+s+c,l=E(n)?""===(i=n)||"#"===i.charAt[0]?i:"#".concat(i):c,d=a+Ge(s,t||[])+l;if(d!==u){var h=r?"pushState":"replaceState";this.targetWindow.history[h]("","",d),this.changeStateCallbacks.forEach((function(e){return e()}))}return d}},{key:"handlePopState",value:function(e){var t=e.target.location,n=t.pathname,r=n+t.search;this.isInternalNavigation(n)&&this.lastFetchPath!==r&&this.refreshPage()}},{key:"fetch",value:function(e){var t=this;this.lastFetchPath=e,this.rawDataListenersRegistry.triggerProgressListener(),this.opboxWebClient.getPageData(e).then((function(e){return t.rawDataListenersRegistry.triggerChangeListener(e)})).catch(Je)}},{key:"registerChangeCallback",value:function(e){this.registerCallback(e,this.changeCallbacks)}},{key:"registerChangeStateCallback",value:function(e){this.registerCallback(e,this.changeStateCallbacks)}},{key:"registerCallback",value:function(e){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[];P(e)?n.push(e):this.reportError(new Error('First argument must be a function but got "'.concat(t(e),'"')))}},{key:"createAPI",value:function(){return{registerChangeCallback:this.registerChangeCallback.bind(this),registerChangeStateCallback:this.registerChangeStateCallback.bind(this),changeState:this.changeState.bind(this)}}}]),e}(),Ye="opboxAnimationTimerInterval",Ke=function(e){return e<.5?8*e*e*e*e:1-8*--e*e*e*e},Qe=function(e){return e.requestAnimationFrame||e.webkitRequestAnimationFrame||e.mozRequestAnimationFrame||function(e){setTimeout(e,1e3/60)}};function $e(e,t,n,r){var i=arguments.length>4&&void 0!==arguments[4]?arguments[4]:{},o=i.duration,a=void 0===o?500:o,s=i.onFinish;if("function"!=typeof r)return null;var c=Qe(e),u=Date.now(),l=n-t,d=!1,h=function(){d=!0},f=function e(){var n=Date.now()-u;if(d||n>=a)"function"==typeof s&&s(),d=!1;else{var i=Math.min(n/a,1),o=Ke(i)*l+t;r(o),c(e)}};return f(),{stop:h}}function Ze(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},r=n.duration,i=void 0===r?500:r,o=e.pageYOffset,a=Math.max(0,t),s=e.document.body.scrollHeight;function c(t){var n=t===a||t===a,r=e.innerHeight+t>=s;return n||r}function u(){e[Ye]&&"function"==typeof e[Ye].stop&&(e[Ye].stop(),e[Ye]=null)}var l=function(t){e.scrollTo(0,Math.round(t)),c(t)&&u()};u(),e[Ye]=$e(e,o,t,l,{duration:i})}var et=function(){function e(){var t=this;n(this,e),this.status=1,this.promise=new Promise((function(e){t.resolve=e}))}return i(e,[{key:"registerImplementation",value:function(e){this.status=2,this.resolve(e)}}]),e}(),tt=function(){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},r=t.reportError,i=t.allowedPlugins,o=void 0===i?[]:i;n(this,e),this.reportError=r,this.pluginsRegistry=new Map,this.boundUpdateRegistry=this.updateRegistry.bind(this),this.updateRegistry(o)}return i(e,[{key:"isPluginAvailable",value:function(e){return this.pluginsRegistry.has(e)}},{key:"reportRegistrationError",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1],n=new Error("Plugin registration error. ".concat(e));t?console.error(n):this.reportError(n)}},{key:"addPluginToRegistry",value:function(e){var t=e.name;this.isPluginAvailable(t)||this.pluginsRegistry.set(t,new et)}},{key:"register",value:function(e,t){if(e){var n=e.name;if("string"==typeof n)if(n)if(t)if(this.isPluginAvailable(n)){var r=this.pluginsRegistry.get(n);2!==r.status?r.registerImplementation(t):this.reportRegistrationError('Plugin "'.concat(n,'" is already registered on page'),!0)}else this.reportRegistrationError('Plugin "'.concat(n,'" is not allowed to register on this page'));else this.reportRegistrationError('Second argument "implementation" is required');else this.reportRegistrationError('Property "name" should be a non-empty string');else this.reportRegistrationError('Property "name" should be a string')}else this.reportRegistrationError('First argument "config" should be defined')}},{key:"getPlugin",value:function(e){return this.isPluginAvailable(e)?this.pluginsRegistry.get(e).promise:Promise.reject(new Error('Plugin "'.concat(e,'" is unavailable')))}},{key:"updateRegistry",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[];e.forEach(this.addPluginToRegistry.bind(this))}},{key:"createAPI",value:function(){return{register:this.register.bind(this),get:this.getPlugin.bind(this)}}}]),e}();function nt(e,t){return function(n){if(!e.has(n))return Promise.reject(new Error("Service ".concat(n," is not registered")));var r=e.get(n);return r.fetchIfNotFetched(t),r.promise}}var rt=function(){function e(t){var r=this,i=t.prototypeName,o=t.servicesRegistry,a=t.targetWindow;n(this,e),this.services=new Map,this.targetWindow=a,o.forEach((function(e,t){e.components.some((function(e){return e.prototypeName===i}))&&r.services.set(t,e)})),this.get=nt(this.services,this.targetWindow)}return i(e,[{key:"has",value:function(e){return this.services.has(e)}}]),e}();function it(e,t){return t.filter((function(t){return!e.find((n=t,function(e){if(n.url)return[e.url,e.href,e.src].includes(n.url);if(n.code){var t=n.attributes,r=void 0===t?{}:t,i=!Object.keys(r).some((function(t){return r[t]!==R(e.node,t)}));return n.code===e.code&&i}return!1}));var n}))}function ot(e,t,n){if(!t.length)return Promise.resolve();var r=function(e){return S(e.document.getElementsByTagName("script"),(function(e){return{src:e.src,code:e.innerHTML,nonce:e.nonce,node:e}}))}(e),i=function(e){return(e.find((function(e){return!!e.nonce}))||{}).nonce}(r),o=it(r,t);return Promise.all(o.map(function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:U,r=Je(e),i=Y(e);return function(o){var a=o.url,s=o.code,c=o.attributes,u=o.type,l=o.async;return a||s?new Promise((function(o){var d,h=!a&&!!s,v="module"===u,p=W(e.document,"script"),m=!1,g=function e(t){o(),t.message||(t.message="Error while loading script: ".concat(a)),r(t),p.removeEventListener("error",e)};if(!v||i){if(c){if(c.nomodule&&i)return void o();Object.entries(c).forEach((function(t){var n=f(t,2),r=n[0],i=n[1];"data-serialize-box-id"!==r&&"data-serialize-box-name"!==r||(m=!0,d=e.document.querySelector("[".concat(r,'="').concat(i,'"]'))),p.setAttribute(r,i)}))}t&&p.setAttribute("nonce",t),l&&p.setAttribute("async","async"),u&&(p.type=u),h?(p.innerHTML=s,o()):(p.src=a,p.addEventListener("load",(function e(){o(),p.removeEventListener("error",g),p.removeEventListener("load",e)})),p.addEventListener("error",g)),d?d.parentNode.replaceChild(p,d):e.document.body.appendChild(p),m&&n()}else o()})):Promise.resolve()}}(e,i,n)))}var at=function(){function e(t){var r=this,i=t.assetUrl,o=t.components,a=t.reportError;n(this,e),this.assetUrl=i,this.components=o,this.reportError=a,this.implementation=null,this.status=0,this.promise=new Promise((function(e,t){r.resolve=e,r.reject=t}))}return i(e,[{key:"update",value:function(e){this.components=function(e,t){return t.reduce((function(e,t){return e.find((function(e){return e.prototypeName===t.prototypeName}))?e:e.concat(t)}),e)}(this.components,e)}},{key:"registerImplementation",value:function(e){try{this.implementation=new e,this.status=2,this.resolve(this.implementation)}catch(e){this.handleError(e)}}},{key:"fetchIfNotFetched",value:function(e){var t=this;0===this.status&&(this.status=1,ot(e,[{url:this.assetUrl}]).catch((function(e){t.handleError(e)})))}},{key:"handleError",value:function(e){this.reportError(e),this.status=2,this.reject()}}]),e}(),st=function(){function e(t){var r=this,i=t.targetWindow,o=t.reportError;n(this,e),this.targetWindow=i,this.reportError=o,this.servicesRegistry=new Map;var a=this.targetWindow.document.querySelector('script[data-config="services"]');if(a)try{b(Q(a)).forEach((function(e){var t=f(e,2),n=t[0],i=t[1],o=i.assetUrl,a=i.components;r.setServiceToRegistry(n,o,a)}))}catch(e){this.reportError(e)}this.dangerouslyGet=nt(this.servicesRegistry,this.targetWindow),this.update=this.update.bind(this)}return i(e,[{key:"getServicesForComponent",value:function(e){return new rt({prototypeName:e,servicesRegistry:this.servicesRegistry,targetWindow:this.targetWindow})}},{key:"setServiceToRegistry",value:function(e,t,n){this.servicesRegistry.set(e,new at({assetUrl:t,components:n,reportError:this.reportError}))}},{key:"update",value:function(e){var t=this;e.forEach((function(e){var n=f(e,2),r=n[0],i=n[1],o=i.assetUrl,a=i.components;t.servicesRegistry.has(r)?t.servicesRegistry.get(r).update(a):t.setServiceToRegistry(r,o,a)}))}},{key:"register",value:function(e,t){var n=e.serviceName;this.servicesRegistry.get(n).registerImplementation(t)}},{key:"createAPI",value:function(){return{register:this.register.bind(this),__dangerouslyGet__:this.dangerouslyGet.bind(this)}}}]),e}();function ct(e,n){e.forEach((function(e){var r=e.args,i=e.reject,o=e.resolve,a=function(e,n){try{return e.apply(void 0,v(n))}catch(e){return console.error(e),void("object"===t("NREUM")&&null!==NREUM&&"function"==typeof NREUM.noticeError&&NREUM.noticeError(e))}}(n,r);a&&P(a.then)&&P(o)&&P(i)&&a.then(o,i)}))}var ut=function(){return Date.now()};var lt=function(){function e(t){var r=t.localStorage,i=t.reportError,o=t.ttlMs,a=void 0===o?2592e6:o,s=t.key,c=void 0===s?"opbox.preferences":s,u=t.timeProvider,l=void 0===u?ut:u;n(this,e),this.writeToStorage=this.writeToStorage.bind(this),this.loadPreferences=this.loadPreferences.bind(this),this.cleanupPreferences=this.cleanupPreferences.bind(this),this.savePreferences=this.savePreferences.bind(this),this.storage=function(e){try{var t="test_preferences_storage";return e.setItem(t,t),e.getItem(t),e.removeItem(t),!0}catch(e){return!1}}(r)?r:{setItem:function(){},getItem:function(){return{}}},this.ttlMs=a,this.key=c,this.timeProvider=l,this.reportError=i}return i(e,[{key:"savePreferences",value:function(e){var t=this.loadPreferences(),n=this.timeProvider(),r=e.reduce(G((function(e){return o({},e.name,{value:e.value,timestamp:n})})),t);this.writeToStorage(r)}},{key:"writeToStorage",value:function(e){try{this.storage.setItem(this.key,JSON.stringify(e))}catch(e){this.reportError(e)}}},{key:"loadPreferences",value:function(){try{return b(this.storage.getItem(this.key))||{}}catch(e){return this.reportError(e),{}}}},{key:"cleanupPreferences",value:function(){var e=this,t=this.loadPreferences(),n=this.timeProvider(),r=Object.entries(t).reduce(G((function(t){var r=f(t,2),i=r[0],a=r[1];return a.timestamp+e.ttlMs>n?o({},i,a):{}})),{});this.writeToStorage(r)}}]),e}(),dt=["Content-Type"],ht={withCredentials:!0,headers:{"Content-Type":"application/vnd.allegro.internal.v1+json",Accept:"application/vnd.allegro.internal.v1+json"}},ft=function(){function e(t){var r=t.edgeClient,i=t.localStorage,o=t.ttlMs,a=t.reportError;n(this,e),this.edgeClient=r,this.storage=new lt({localStorage:i,ttlMs:o,reportError:a}),this.setPreference=this.setPreference.bind(this),this.getPreference=this.getPreference.bind(this),this.setPreferences=this.setPreferences.bind(this),this.getPreferences=this.getPreferences.bind(this),this.getPreferencesFromLocalStorageOrDefaults=this.getPreferencesFromLocalStorageOrDefaults.bind(this)}return i(e,[{key:"setPreference",value:function(e,t){var n={name:e,value:t};return this.storage.savePreferences([n]),this.edgeClient.post("/preferences",n,ht)}},{key:"getPreference",value:function(e,t){return"string"==typeof e||e instanceof String?this.getPreferences(o({},e,t)).then((function(t){return t[e]})):Promise.reject(Error("illegal argument type provided as preference name"))}},{key:"setPreferences",value:function(e){if(!w(e))return Promise.reject(Error("illegal argument type provided as preferences"));var t=Object.entries(e).map((function(e){var t=f(e,2);return{name:t[0],value:t[1]}}));return this.storage.savePreferences(t),this.edgeClient.post("/preferences/multi",JSON.stringify(t),ht)}},{key:"getPreferences",value:function(e){var t=this;if(!w(e))return Promise.reject(Error("illegal argument type provided as preferences"));var n=Object.keys(e).join(","),r="".concat("/preferences","?name=").concat(n),i=ht.withCredentials,a=ht.headers,s=(a["Content-Type"],d(a,dt));return this.edgeClient.get(r,{withCredentials:i,headers:s}).then((function(e){var n=e.data.preferences;return t.storage.savePreferences(n),n.reduce(G((function(e){return o({},e.name,e.value)})),{})})).catch((function(){return t.getPreferencesFromLocalStorageOrDefaults(e)}))}},{key:"getPreferencesFromLocalStorageOrDefaults",value:function(e){this.storage.cleanupPreferences();var t=this.storage.loadPreferences();return Object.entries(e).reduce(G((function(e){var n=f(e,2),r=n[0],i=n[1];return o({},r,r in t?t[r].value:i)})),{})}},{key:"createAPI",value:function(){return{set:this.setPreference,get:this.getPreference,setMany:this.setPreferences,getMany:this.getPreferences}}}]),e}();function vt(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},r=n.inHead,i=void 0!==r&&r,o=n.referenceNode,a=void 0===o?null:o;return function(n){if(x(n))return null;q(n,(function(e,t){return!t}));var r=W(e.document,"link",n,{rel:t});if(a)V(a,r);else{var o=i?"head":"body";e.document[o].appendChild(r)}return r}}var pt=["spinner","button","link","badge","brand","bubble","card","chart","desk","divider","heading","hint","icon","indicator","input","list","timeline","marker","notification","placeholder","price","progress","table","dropdown","breadcrumb","accordion","carousel","chip","choice","dialog","field","image-tile","input-group","message","modal","pagination","range","select","sheet","slider","soap","stepper","tabs","typography","color","grid","calendar","attachment","article","navigation-tiles","pin","player-video","align","border","box-sizing","display","flex","height","margin","padding","position","transition","utils","visibility","white-space","width","zindex","core"];var mt,gt=function(e,t,n){var r=t.href,i=t.media,o=vt(e,"stylesheet",{inHead:!0,referenceNode:n})({type:"text/css",href:r,media:i});return new Promise((function(e,t){o.addEventListener("error",t),o.addEventListener("load",e)}))},yt=function(e){return function(t){return-1!==t.href.indexOf(e)}};function bt(e,t){return S(e.cssRules).findIndex((function(e){return e.selectorText===t}))}function kt(e,t,n){var r=t.cssBundle,i=r.isBundleEnabled,o=r.emptyRule,a=i?function(e){return S(e.document.styleSheets).find((function(e){var t=e.ownerNode;return t&&I(t,"data-metrum-bundle")}))}(e):null,s=[],c=function(e){return o.pattern.replace(o.replacementPart,e)};return{isBundleEnabled:i,inject:function(t){if(!i)return Promise.resolve();var r=function(e,t){return t.reduce((function(t,n){var r=f(t,2),i=r[0],o=r[1];return e.includes(n)||o.push(n),i.push(n),[i,o]}),[[],[]])}(s,t),o=f(r,2),u=o[0],l=o[1];return s=u,l.length?function(e,t){var n=W(e,"iframe",{style:"display:none"}),r=function(){return e.body.removeChild(n)};e.body.appendChild(n);var i=n.contentDocument,o=n.contentWindow;return i.open("text/html","replace"),i.write(t.map(K).join("")),i.close(),new Promise((function(e){var n=function(){return e([S(i.styleSheets),r])};"complete"===i.readyState&&i.styleSheets.length===t.length?n():o.addEventListener("load",(function e(){o.removeEventListener("load",e),n()}))}))}(e.document,l).then((function(e){var t=f(e,2),r=t[0],i=t[1];r.forEach((function(e){if(!function(e,t){return t.cssRules.length>0&&S(e.cssRules).findIndex((function(e){return e.cssText===t.cssRules[0].cssText}))>-1}(a,e)){var t=L(e.href),r=n.indexOf(t),i=-1!==r?n.slice(r):[];i.push("non-metrum");for(var o=a.cssRules.length,s=0;s<i.length;s+=1){var u=bt(a,c(i[s]));if(u>0){o=u;break}}var l=S(e.cssRules);l.unshift({cssText:"".concat(c(t),"{}")});for(var d=0;d<l.length;d+=1)a.insertRule(l[d].cssText,o+d)}})),i()})):Promise.resolve()}}}function wt(e,t,n,r){var i=n.href,o=n.media,a=L(i);return r.includes(a)?gt(e,{href:i,media:o},function(e,t,n){var r=e.filter((function(e){return e.isMetrum})),i=t.slice(0,t.indexOf(n)).reverse().find((function(e){return r.find(yt(e))})),o=i?r.find(yt(i)).node:null;return!o&&r.length?r[0].node.previousElementSibling:!o&&e.length?e[0].node.previousElementSibling:o}(t,r,a)):Promise.resolve()}function Et(e,t,n){var r=n.url,i=n.code,o=n.media;return B(r)?wt(e,t,{href:r,media:o},pt):r?gt(e,{href:r,media:o}):i?function(e,t){var n=W(e.document,"style",{innerHTML:t});return e.document.head.appendChild(n),Promise.resolve()}(e,i):Promise.reject()}function Ct(e,t,n){if(!t.length)return Promise.resolve();var r=[].concat(v(function(e){return N(e,'link[type="text/css"],style',(function(e){return{href:e.href,code:e.innerHTML,media:e.media,node:e,isMetrum:B(e.href)}})).filter((function(e){var t=e.href,n=e.code;return t||n}))}(e.document)),v(function(e,t,n){var r=[],i=A(e,n.selectors.bundledStylesMap);if(!i)return r;try{return b(Q(i))}catch(e){return t(new Error("Bundled styles map: invalid JSON")),r}}(e.document,Je(e),n))),i=it(r,t),o=mt=mt&&!mt.forceRefresh?mt:kt(e,n,pt),a=o.inject,s=o.isBundleEnabled,c=f(i.reduce((function(t,n){return B(n.url)&&s?(t[0].push(n.url),t):(t[1].push(Et(e,r,n)),t)}),[[],[]]),2),u=c[0],l=c[1];return l.push(a(u)),Promise.all(l)}function Pt(e){var t=e.targetWindow,n=e.webResponse,r=e.config,i=n.svgColorMatrixFilters,o=void 0===i?"":i,a=n.assets,s=a.styles,c=void 0===s?[]:s,u=a.prefetches,l=void 0===u?[]:u,d=a.preloads,h=void 0===d?[]:d;return function(e,t){var n=e.document;if(t){var r=A(n,"#svg-color-matrix-filters"),i=W(n,"div",{innerHTML:t}).querySelector("svg");r?N(i,"filter",(function(e){r.querySelector("#".concat(R(e,"id")))||r.appendChild(e)})):n.body.insertBefore(i,n.body.firstChild)}}(t,o),h.forEach(vt(t,"preload")),l.forEach(vt(t,"prefetch")),Ct(t,c,r)}function xt(e){var t=e.targetWindow,n=e.webResponse,r=e.lazyScriptsManager,i=e.updateSerializedPropsCollectionCallback,o=n.assets.scripts,a=f((void 0===o?[]:o).reduce((function(e,t){return t.lazyDownload?e[0].push(t):e[1].push(t),e}),[[],[]]),2),s=a[0];return ot(t,a[1],i).then((function(){return r.handleSubtreeAssets(s)}))}var St=function(e){var t=e.config,n=e.targetWindow,r=e.unmountNodeCallback,i=e.mountNodeCallback,o=e.updateServicesCallback,a=e.updateAllowedPluginsCallback,s=e.updateSerializedPropsCollectionCallback,c=e.updateComponentNodesCollectionCallback,u=e.injectStylesPreloadsAndPrefetches,l=void 0===u?Pt:u,d=e.injectScripts,h=void 0===d?xt:d,f=e.lazyScriptsManager;function v(e){return n.document.querySelector('[data-box-id="'.concat(e,'"]'))}return function(e){var u=e.boxId,d=e.data,p=e.isPlaceholder,m=d.htmlString,g=d.servicesConfig,y=d.allowedPlugins;return o(g),a(y),l({targetWindow:n,webResponse:d,config:t}).then((function(){var e=p?function(e){return n.document.querySelector('[data-placeholder-for="'.concat(e,'"]'))}(u):v(u);if(r(e),!m)return e.parentNode.removeChild(e),!1;var t=W(n.document,"div",{innerHTML:m});return e.parentNode.replaceChild(t.firstElementChild,e),!0})).then((function(e){c(),h({targetWindow:n,webResponse:d,lazyScriptsManager:f,updateSerializedPropsCollectionCallback:s}).then((function(){return e&&i(v(u))}))}))}},Nt=function(e){var t=e.config,n=e.targetWindow,r=e.unmountNodeCallback,i=e.mountNodeCallback,o=e.updateServicesCallback,a=e.updateAllowedPluginsCallback,s=e.updateSerializedPropsCollectionCallback,c=e.updateComponentNodesCollectionCallback,u=e.injectStylesPreloadsAndPrefetches,l=void 0===u?Pt:u,d=e.injectScripts,h=void 0===d?xt:d,f=e.lazyScriptsManager;function v(e){return n.document.querySelector('[data-pathname="'.concat(e,'"]'))}function p(e,t){var r=W(n.document,"div",{innerHTML:t});return r.setAttribute("data-pathname",e),r}return function(e){var u=e.pathname,d=e.data,m=d.htmlString,g=d.servicesConfig,y=d.allowedPlugins;return o(g),a(y),l({targetWindow:n,webResponse:d,config:t}).then((function(){var e=v(u);if(!e&&m){var t=p(u,m);return n.document.body.appendChild(t),!0}if(e){if(r(e),!m)return e.parentNode.removeChild(e),!1;var i=p(u,m);return e.parentNode.replaceChild(i,e),!0}return!1})).then((function(e){c(),h({targetWindow:n,webResponse:d,lazyScriptsManager:f,updateSerializedPropsCollectionCallback:s}).then((function(){return e&&i(v(u))}))}))}},At=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"";return e+t},It=function(){function e(t,r){n(this,e),this.targetWindow=t,this.observedElements={},this.downloaded=[],this.registered=[],this.dependencyMapCache=[],this.observer=null,this.errorReporter=Je(t),this.componentNodesFinder=r,this.unhandledClicks={}}return i(e,[{key:"createObserverInstance",value:function(){var e=this.observerEntriesHandler.bind(this);this.observer=new this.targetWindow.IntersectionObserver(e,{rootMargin:"800px",threshold:0})}},{key:"markAsDownloaded",value:function(e){this.downloaded.push(e)}},{key:"isDownloaded",value:function(e){return this.downloaded.includes(e)}},{key:"markAsRegistered",value:function(e){this.registered.push(e)}},{key:"isRegistered",value:function(e){return this.registered.includes(e)}},{key:"observeElement",value:function(e,t){this.observedElements[t]=[].concat(v(this.observedElements[t]||[]),[e]),this.observer.observe(e)}},{key:"unobserveAllUnderKey",value:function(e){var t=this;this.observedElements[e].forEach((function(e){return t.observer.unobserve(e)}))}},{key:"getDependencyMapEntry",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"";return this.dependencyMapCache.find((function(n){var r=n.prototypeId,i=n.clientImplementationVersion;return r===e&&(void 0===i?"":i)===t}))}},{key:"addDependencies",value:function(e){var t=this;e.forEach((function(e){var n=e.prototypeId,r=e.clientImplementationVersion;t.getDependencyMapEntry(n,r)||t.dependencyMapCache.push(e)}))}},{key:"observerEntriesHandler",value:function(e){var t=this;e.forEach((function(e){if(e.isIntersecting){var n=e.target.dataset,r=n.civ,i=n.prototypeId,o=t.getDependencyMapEntry(i,r),a=At(i,r);t.isDownloaded(a)||(t.markAsDownloaded(a),t.unobserveAllUnderKey(a),ot(t.targetWindow,o.scripts))}}))}},{key:"observeComponents",value:function(e){var t=this;e.forEach((function(e){var n=e.prototypeId,r=e.clientImplementationVersion,i=t.componentNodesFinder.find(n,r);if(i.length){var o=At(n,r);i.forEach((function(e){t.observeElement(e,o),t.watchForUnhandledClicks(e,o)}))}else t.errorReporter(new Error('Lazy scripts: DOM reference not found for "'.concat(n,"@").concat(r,'"')))}))}},{key:"filterDownloadedScripts",value:function(e){var t=this;return e.filter((function(e){var n=e.prototypeId,r=e.clientImplementationVersion;return!t.isDownloaded(At(n,r))}))}},{key:"watchForUnhandledClicks",value:function(e,t){var n=this;e.addEventListener("click",(function(){n.isRegistered(t)||(n.unhandledClicks[t]=(n.unhandledClicks[t]||0)+1)}))}},{key:"onPrototypeRegistered",value:function(e,t){var n=At(e,t),r=this.unhandledClicks[n];if(this.registered.push(n),r){var i=function(e){var t=e.navigator,n=t.connection,r=t.mozConnection,i=t.webkitConnection;return n||r||i}(this.targetWindow),o=i?" Connection: ".concat(i.effectiveType,", ").concat(i.downlink,"Mbps"):"";this.errorReporter(new Error("Lazy scripts: ".concat(r,' unhandled clicks registered for "').concat(e,"@").concat(t,'" before its script was downloaded.').concat(o)))}}},{key:"handleSSRAssets",value:function(){var e,t,n=this,r=this.targetWindow.document;t=function(){n.dependencyMapCache=function(e,t){var n=A(e,'script[data-config="lazy-scripts-map"]'),r=[];if(!n)return r;try{return b(Q(n))}catch(e){return t(new Error("Lazy scripts: incorrect dependency map JSON")),r}}(r,n.errorReporter),x(n.dependencyMapCache)||(n.createObserverInstance(),n.observeComponents(n.dependencyMapCache))},"loading"===(e=r).readyState?X(e,"DOMContentLoaded",t):t()}},{key:"handleSubtreeAssets",value:function(e){var t=this,n=this.filterDownloadedScripts(e);if(!x(n)){var r=function(e){return y(e.reduce((function(e,t){var n=t.prototypeId,r=t.clientImplementationVersion,i=At(n,r),o=e[i];return o?(o.scripts.push(t),e):(e[i]={prototypeId:n,clientImplementationVersion:r,scripts:[t]},e)}),{}))}(n);this.addDependencies(r),this.observer||this.createObserverInstance(),setTimeout((function(){return t.observeComponents(r)}),0)}}}]),e}(),Rt=function(){function e(t){n(this,e),this.targetWindow=t,this.collection=[],this.updateNodesCollection()}return i(e,[{key:"updateNodesCollection",value:function(){this.collection=N(this.targetWindow.document,"div[data-prototype-id]")}},{key:"find",value:function(e,t){return t?this.collection.filter((function(n){return O(n)===e&&j(n)===t})):this.collection.filter((function(t){return O(t)===e}))}}]),e}(),Ot=new(function(){function e(t,r,i){n(this,e),this.targetWindow=t;var o=function(e){return ne(e).config}(this.targetWindow),a=new ie({targetWindow:t}),s=new qe({targetWindow:t,config:o}),c=new _e({targetWindow:t}),u=new Te({targetWindow:t,config:o,cookieMonsterClient:s,boxViewsMarker:c,sendPerformanceMetrics:this.sendPerformanceMetrics.bind(this)}),l=Je(t),d=new st({targetWindow:t,reportError:l}),h=new Rt(t),f=new It(t,h),v=function(e){var t=e.targetWindow,n=e.reportError,r=e.componentNodesFinder,i=new Ue(t,n),o=new Be(Object.assign({},e,{serializedPropsFinder:i}));return{public:Object.assign({init:He(0,r)},o.createPublicAPI()),private:o.createPrivateAPI()}}({targetWindow:t,services:d,reportError:l,componentNodesFinder:h,registerPrototypeCallback:f.onPrototypeRegistered.bind(f),unmountNodeCallback:c.unmountNode.bind(c),mountNodeCallback:c.markBoxAsRendered.bind(c)}),p=new tt({reportError:l,allowedPlugins:o.allowedPlugins}),m=new pe({appContext:a,analytics:u,updateComponentCallback:v.private.updateComponentCallback,beforeUpdateComponentCallback:v.private.beforeUpdateComponentCallback}),g={config:o,targetWindow:t,unmountNodeCallback:v.private.unmountNode,mountNodeCallback:v.private.mountNode,updateSerializedPropsCollectionCallback:v.private.updateSerializedPropsCollection,updateComponentNodesCollectionCallback:v.private.updateComponentNodesCollection,updateServicesCallback:d.update,updateAllowedPluginsCallback:p.boundUpdateRegistry,lazyScriptsManager:f},y=new fe({httpClient:r,reportError:l,boxRenderCallback:St(g),fragmentRenderCallback:Nt(g)});this.config=o,this.cookieMonsterClient=s,this.boxViewsMarker=c,this.analytics=u,this.services=d,this.componentAPI=v,this.rawDataListenersRegistry=m,this.opboxWebClient=y,this.plugins=p,this.reportError=l,this.lazyScriptsManager=f,this.navigation=new Xe({targetWindow:t,opboxWebClient:y,rawDataListenersRegistry:m,reportError:l}),this.edgeClient=new Fe({httpClient:i,edgeHost:o.edgeHost,language:o.language}),this.edgeUploadClient=new Fe({httpClient:i,edgeHost:o.edgeUploadHost,language:o.language}),this.preferencesClient=new ft({edgeClient:this.edgeClient,localStorage:this.targetWindow.localStorage,reportError:this.reportError}),this.uiTools=function(e){var t=function(t){return"string"!=typeof t?null:e.document.querySelector('a[name="'.concat(t,'"]'))},n=function(t){var n=e.pageYOffset||e.document.documentElement.scrollTop||0;return t?t.getBoundingClientRect().top+n:null};return{getBoxAnchorNode:t,getTopOffset:n,scrollTo:function(r){var i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},o=i.animate,a=void 0===o||o,s={duration:a?500:0};if("number"!=typeof r){var c=t(r);if(c){var u=n(c);Ze(e,u,s)}}else Ze(e,r,s)},tween:function(){for(var t=arguments.length,n=new Array(t),r=0;r<t;r++)n[r]=arguments[r];return $e.apply(void 0,[e].concat(n))}}}(t),this.lazyScriptsManager.handleSSRAssets(),this.analytics.initialize(),this.navigation.initialize(),this.boxViewsMarker.initialize()}return i(e,[{key:"API",get:function(){return{analytics:this.analytics.createAPI(),boxViewsMarker:this.boxViewsMarker.createAPI(),component:this.componentAPI.public,plugin:this.plugins.createAPI(),onData:this.rawDataListenersRegistry.registerListener.bind(this.rawDataListenersRegistry),changeParams:this.navigation.navigateRelative.bind(this.navigation),refreshPage:this.navigation.refreshPage.bind(this.navigation),tween:this.uiTools.tween,scrollTo:this.uiTools.scrollTo,page:this.opboxWebClient.createAPI(),navigation:this.navigation.createAPI(),edge:this.edgeClient.createAPI(),edgeUpload:this.edgeUploadClient.createAPI(),preferences:this.preferencesClient.createAPI(),onDomReady:this.domReadyHelper.bind(this),loaded:!0,performance:ne(this.targetWindow).performance,services:this.services.createAPI(),reportError:this.reportError}}},{key:"domReadyHelper",value:function(e){"loading"===this.targetWindow.document.readyState?this.targetWindow.document.addEventListener("DOMContentLoaded",e):this.targetWindow.setTimeout(e,0)}},{key:"lazyloadedElement",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=e.target,n=R(t,"data-placeholder-for");n&&this.opboxWebClient.render.box({boxId:n,isPlaceholder:!0})}},{key:"renderBoxForLazyloadedPlaceholders",value:function(){var e=this;Array.from(this.targetWindow.document.querySelectorAll("[".concat("data-placeholder-for","].lazyloaded")),(function(t){var n=R(t,"data-placeholder-for");return e.opboxWebClient.render.box({boxId:n,isPlaceholder:!0})}))}},{key:"broadcastAPILoadEvent",value:function(){D(this.targetWindow,"opboxAPILoaded",this.targetWindow.document)}},{key:"attach",value:function(){var e,t,n,r=this,i=ne(this.targetWindow),o=this.API;i&&(!function e(t,n,r){for(var i=arguments.length,o=new Array(i>3?i-3:0),a=3;a<i;a++)o[a-3]=arguments[a];if(P(t)&&P(n)){if(!t.__queue__)return;ct(t.__queue__,n),r.apply(void 0,[n].concat(o))}else w(t)&&w(n)&&Object.keys(t).forEach((function(i){e.apply(void 0,[t[i],n[i],r].concat(v(o.concat(i))))}))}(i,o,(function(e){for(var t=arguments.length,n=new Array(t>1?t-1:0),o=1;o<t;o++)n[o-1]=arguments[o];return re(r.targetWindow,F.apply(void 0,[i,e].concat(n)))})),e=i,n=o,t=Object.keys(n).concat("initialized","config"),q(e,(function(e){return!t.includes(e)})),Object.freeze(i)),this.broadcastAPILoadEvent(),this.targetWindow.addEventListener("lazyloaded",this.lazyloadedElement.bind(this)),o.performance.markTimeToInteractive("@allegro/opbox-web-browser")}},{key:"sendPerformanceMetrics",value:function(){this.targetWindow.pinter&&this.targetWindow.pinter.sendUserTimings&&this.targetWindow.pinter.sendUserTimings()}},{key:"run",value:function(){this.attach(),this.renderBoxForLazyloadedPlaceholders()}}]),e}())(window,te(),te());Ot.run();var Mt=Ot.attach.bind(Ot);var Tt=Object.freeze({__proto__:null,MIN_ENGAGEMENT_DURATION_IN_MS:2e3,CYCLE_DURATION_IN_MS:6e3,attachEngagementObserver:function(e){var t,n=e.targetWindow,r=e.onCycleComplete,i=Date.now,o=i(),a=function(){return n.innerHeight+(n.scrollY||n.document.documentElement.scrollTop)},s=0,c=0,u=a(),l=null,d=!1,h=function(e,t,n){return e.addEventListener(t,n)},f=function(e){if(l){var t;if(l<s){var n=e-s,r=2e3-(s-l);t=Math.min(n,r)}else{var i=e-l;t=Math.min(i,2e3)}c+=t}},v=function(){return i()-o},p=function(){d=!1;var e,t=v();f(t),(e=a())>u&&(u=e),l=t},m=function(){var e,t,i;e=v(),f(e),c>0&&r({engagementTime:Math.min(c,6e3),scrollBottom:u,pageHeight:(t=n.document,i=t.body,t.documentElement.scrollHeight||i.scrollHeight)}),l<e-2e3&&(l=null),c=0,s=e,u=a()};h(n.document,"click",p),h(n.document,"mousemove",p),h(n.document,"keydown",p),h(n.document,"scroll",(function(){d||(d=!0,n.requestAnimationFrame(p))})),h(n,"pagehide",(function(){n.clearInterval(t),m()})),h(n,"pageshow",(function(){s=v(),t=n.setInterval(m,6e3)}))}});return e.attach=Mt,e}({});