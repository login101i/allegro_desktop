!function(t,e){for(var n in e)t[n]=e[n]}(window,function(t){var e={};function n(i){if(e[i])return e[i].exports;var o=e[i]={i:i,l:!1,exports:{}};return t[i].call(o.exports,o,o.exports,n),o.l=!0,o.exports}return n.m=t,n.c=e,n.d=function(t,e,i){n.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:i})},n.r=function(t){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},n.t=function(t,e){if(1&e&&(t=n(t)),8&e)return t;if(4&e&&"object"==typeof t&&t&&t.__esModule)return t;var i=Object.create(null);if(n.r(i),Object.defineProperty(i,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var o in t)n.d(i,o,function(e){return t[e]}.bind(null,o));return i},n.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return n.d(e,"a",e),e},n.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},n.p="https://assets.allegrostatic.com/opbox-countdown/",n(n.s=0)}({"+GN7":function(t,e){t.exports="9bb"},0:function(t,e,n){t.exports=n("O14P")},O14P:function(t,e,n){"use strict";n.r(e);var i=n("+GN7"),o=n.n(i),r=function(t,e){return t.getAttribute("data-".concat(e))},s=function(t,e){return t.querySelector('[data-role="'.concat(e,'"]'))},a=function(t,e){t&&(t.innerHTML=e)},c=function(){return window.location.reload()},d=function(){function t(e){var n=e.baseNode,i=e.services;!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this.node=n.querySelector('[data-role="countdown"]'),this.template=r(this.node,"template"),this.datetime=r(this.node,"datetime"),this.digitColor=r(this.node,"digitcolor"),this.digitBackground=r(this.node,"digitbackground"),this.digitBorder=r(this.node,"digitborder"),this.reload=r(this.node,"reload"),this.delay=r(this.node,"delay"),this.boxId=this.getBoxId(),this.unmountListenersSet=new Set,this.services=i,this.shouldTriggerRerender=!1}var e;return(e=[{key:"getBoxId",value:function(){var t=r(this.node,"target-box-name")||void 0,e=t&&this.node.closest('[data-box-name="'.concat(t,'"]'));return e&&r(e,"box-id")}},{key:"getRemainingTime",value:function(){var t,e,n=Date.parse(this.datetime)-Date.parse(((e=new Date(t=new Date)).setMinutes(t.getMinutes()-t.getTimezoneOffset()),e)),i=Math.floor(n/1e3%60),o=Math.floor(n/1e3/60%60),r=Math.floor(n/36e5%24);return{total:n,days:Math.floor(n/864e5),hours:r,minutes:o,seconds:i}}},{key:"renderDigitStyles",value:function(){var t=[this.digitColor&&"color: ".concat(this.digitColor,";"),this.digitBackground&&"background-color: ".concat(this.digitBackground,";"),this.digitBorder&&"border: 1px solid ".concat(this.digitBorder,";")].filter(Boolean);return t.length?'style="'.concat(t.join(" "),'"'):""}},{key:"renderDigit",value:function(t){var e=this,n=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],i=t<10?"0".concat(t):t,o=i.toString().split("").map((function(t){return'<span class="'.concat(e.digitClasses,'"').concat(e.digitStyles,">").concat(t,"</span>")})),r=n?'<div class="'.concat(this.separatorClasses,'">:</div>'):"";return"".concat(o.join("")).concat(r)}},{key:"updateClock",value:function(){var t=this.getRemainingTime();t.total>=0?(this.shouldTriggerRerender=!0,0===t.days?(a(this.optionalSelector,""),"box"===this.template&&a(this.daysLegend,"")):a(this.daysSelector,this.renderDigit(t.days)),a(this.hoursSelector,this.renderDigit(t.hours)),a(this.minutesSelector,this.renderDigit(t.minutes)),a(this.secondsSelector,this.renderDigit(t.seconds,!1))):(this.shouldTriggerRerender&&this.services&&this.services.get("@allegro/opbox-rerender-service").then((function(t){t.triggerRerender("COUNTDOWN_COMPLETE")})),clearInterval(this.timeInterval)),Math.abs(t.total)<this.delay&&("true"===this.reload?setTimeout(this.initReload.bind(this),this.delay):this.boxId&&(clearInterval(this.timeInterval),setTimeout(this.initRefreshBox.bind(this),this.delay)))}},{key:"initReload",value:function(){document.hasFocus()?c():(document.addEventListener("visibilitychange",c),this.unmountListenersSet.add((function(){return document.removeEventListener("visibilitychange",c)})))}},{key:"initRefreshBox",value:function(){var t=function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:window;return function(){return e.opbox.page.renderSubtree({boxId:t})}}(this.boxId);document.hasFocus()?t():(document.addEventListener("visibilitychange",t),this.unmountListenersSet.add((function(){return document.removeEventListener("visibilitychange",t)})))}},{key:"unmountListeners",value:function(){this.unmountListenersSet.forEach((function(t){return t()})),this.unmountListenersSet.clear()}},{key:"onMount",value:function(){this.optionalSelector=s(this.node,"opbox-countdown-optional"),this.daysSelector=s(this.node,"opbox-countdown-days"),this.daysLegend=s(this.node,"opbox-countdown-daysLegend"),this.hoursSelector=s(this.node,"opbox-countdown-hours"),this.minutesSelector=s(this.node,"opbox-countdown-minutes"),this.secondsSelector=s(this.node,"opbox-countdown-seconds"),this.visibleClass=r(this.node,"visible-class-name"),this.digitStyles=this.renderDigitStyles(),this.digitClasses="".concat("_8f114_2JZZB"," ").concat(this.visibleClass),this.separatorClasses="".concat("mp7g_oh _8f114_shMNg"," ").concat(this.visibleClass),this.updateClock(),this.timeInterval=setInterval(this.updateClock.bind(this),1e3)}},{key:"onUnmount",value:function(){clearInterval(this.timeInterval),this.unmountListeners()}}])&&function(t,e){for(var n=0;n<e.length;n++){var i=e[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}(t.prototype,e),t}();window.opbox.component.register({prototypeName:"allegro.countdown",clientImplementationVersion:o.a},d)}}));
//# sourceMappingURL=index_271e2192.js.map